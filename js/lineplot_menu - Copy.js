/************************************************

So far a lot of this code was modified from various sources which I can no longer remember. One includes
http://www.javascripter.net/faq/plotafunctiongraph.htm although a lot of help has been found at w3 schools.

James M. Byrne

*************************************************/

/* Search for minerals ***************************/
function blanksearch() {
  // Declare variables 
  var input, filter, table, tr, td, i;
  input = document.getElementById("censhift_1");
  filter = input.value.toUpperCase();
  table = document.getElementById("mysubTable");
  tr = table.getElementsByTagName("tr");

  // Loop through all table rows, and hide those who don't match the search query
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[0];
    if (td) {
      if (td.innerHTML.toUpperCase().indexOf(filter) > 0) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    } 
  }
}

function bigsearch() {
  // Declare variables 
  
  var table, tr, td, i;
  
  var min4, filtermin4, filtermax4; 
  min4 = document.getElementById("censhift_1"); //IS censhift
  //max4 = min4*0.05; 
  filtermin4 = min4.value*0.9;
  filtermax4 = min4.value*1.1;

  var min5, filtermin5, filtermax5, td5; 
  min5 = document.getElementById("qshift_1"); //QS qshift
  //max5 = min5*0.05; 
  filtermin5 = min5.value*0.95;
  filtermax5 = min5.value*1.05;

  var min7, filtermin7, filtermax7, td7; 
  min7 = document.getElementById("hyperfinefield_1"); // hyperfinefield
  //max7 = min7*0.05; 
  filtermin7 = min7.value*0.95;
  filtermax7 = min7.value*1.05;

  table = document.getElementById("mysubTable");
  tr = table.getElementsByTagName("tr");

  // Loop through all table rows, and hide those who don't match the search query
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[3];
    td5 = tr[i].getElementsByTagName("td")[4];
    td7 = tr[i].getElementsByTagName("td")[6];
    if (td && td5 && td7) {
      if (
      	(td.innerHTML > filtermin4 
      	&& td.innerHTML < filtermax4 
      	&& td7.innerHTML > filtermin7 
      	&& td7.innerHTML < filtermax7) 
      	||
      	(td.innerHTML > filtermin4 
      	&& td.innerHTML < filtermax4 
      	&& td5.innerHTML > filtermin5 
      	&& td5.innerHTML < filtermax5) 
      	) {
      
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    } 
  }
}

function bigsearch2() {
  // For site 2
  
  var table, tr, td, i;
  
  var min4, filtermin4, filtermax4; 
  min4 = document.getElementById("censhift_2"); //IS censhift
  //max4 = min4*0.05; 
  filtermin4 = min4.value*0.9;
  filtermax4 = min4.value*1.1;

  var min5, filtermin5, filtermax5, td5; 
  min5 = document.getElementById("qshift_2"); //QS qshift
  //max5 = min5*0.05; 
  filtermin5 = min5.value*0.95;
  filtermax5 = min5.value*1.05;

  var min7, filtermin7, filtermax7, td7; 
  min7 = document.getElementById("hyperfinefield_2"); // hyperfinefield
  //max7 = min7*0.05; 
  filtermin7 = min7.value*0.95;
  filtermax7 = min7.value*1.05;

  table = document.getElementById("mysubTable2");
  tr = table.getElementsByTagName("tr");

  // Loop through all table rows, and hide those who don't match the search query
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[3];
    td5 = tr[i].getElementsByTagName("td")[4];
    td7 = tr[i].getElementsByTagName("td")[6];
    if (td && td5 && td7) {
      if (
      	(td.innerHTML > filtermin4 
      	&& td.innerHTML < filtermax4 
      	&& td7.innerHTML > filtermin7 
      	&& td7.innerHTML < filtermax7) 
      	||
      	(td.innerHTML > filtermin4 
      	&& td.innerHTML < filtermax4 
      	&& td5.innerHTML > filtermin5 
      	&& td5.innerHTML < filtermax5) 
      	) {
      //if (td.innerHTML > filtermin4 && td5.innerHTML > filtermin5 && td7.innerHTML > filtermin7) {
      
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    } 
  }
}

function bigsearch3() {
  // For site 2
  
  var table, tr, td, i;
  
  var min4, filtermin4, filtermax4; 
  min4 = document.getElementById("censhift_3"); //IS censhift
  //max4 = min4*0.05; 
  filtermin4 = min4.value*0.9;
  filtermax4 = min4.value*1.1;

  var min5, filtermin5, filtermax5, td5; 
  min5 = document.getElementById("qshift_3"); //QS qshift
  //max5 = min5*0.05; 
  filtermin5 = min5.value*0.95;
  filtermax5 = min5.value*1.05;

  var min7, filtermin7, filtermax7, td7; 
  min7 = document.getElementById("hyperfinefield_3"); // hyperfinefield
  //max7 = min7*0.05; 
  filtermin7 = min7.value*0.95;
  filtermax7 = min7.value*1.05;

  table = document.getElementById("mysubTable3");
  tr = table.getElementsByTagName("tr");

  // Loop through all table rows, and hide those who don't match the search query
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[3];
    td5 = tr[i].getElementsByTagName("td")[4];
    td7 = tr[i].getElementsByTagName("td")[6];
    if (td && td5 && td7) {
      if (
      	(td.innerHTML > filtermin4 
      	&& td.innerHTML < filtermax4 
      	&& td7.innerHTML > filtermin7 
      	&& td7.innerHTML < filtermax7) 
      	||
      	(td.innerHTML > filtermin4 
      	&& td.innerHTML < filtermax4 
      	&& td5.innerHTML > filtermin5 
      	&& td5.innerHTML < filtermax5) 
      	) {
      //if (td.innerHTML > filtermin4 && td5.innerHTML > filtermin5 && td7.innerHTML > filtermin7) {
      
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    } 
  }
}

function bigsearch4() {
  // For site 4
  
  var table, tr, td, i;
  
  var min4, filtermin4, filtermax4; 
  min4 = document.getElementById("censhift_4"); //IS censhift
  //max4 = min4*0.05; 
  filtermin4 = min4.value*0.9;
  filtermax4 = min4.value*1.1;

  var min5, filtermin5, filtermax5, td5; 
  min5 = document.getElementById("qshift_4"); //QS qshift
  //max5 = min5*0.05; 
  filtermin5 = min5.value*0.95;
  filtermax5 = min5.value*1.05;

  var min7, filtermin7, filtermax7, td7; 
  min7 = document.getElementById("hyperfinefield_4"); // hyperfinefield
  //max7 = min7*0.05; 
  filtermin7 = min7.value*0.95;
  filtermax7 = min7.value*1.05;

  table = document.getElementById("mysubTable4");
  tr = table.getElementsByTagName("tr");

  // Loop through all table rows, and hide those who don't match the search query
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[3];
    td5 = tr[i].getElementsByTagName("td")[4];
    td7 = tr[i].getElementsByTagName("td")[6];
    if (td && td5 && td7) {
      if (
      	(td.innerHTML > filtermin4 
      	&& td.innerHTML < filtermax4 
      	&& td7.innerHTML > filtermin7 
      	&& td7.innerHTML < filtermax7) 
      	||
      	(td.innerHTML > filtermin4 
      	&& td.innerHTML < filtermax4 
      	&& td5.innerHTML > filtermin5 
      	&& td5.innerHTML < filtermax5) 
      	) {
      //if (td.innerHTML > filtermin4 && td5.innerHTML > filtermin5 && td7.innerHTML > filtermin7) {
      
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    } 
  }
}

/* Moessbauer abundance ***************************/

function piecharts(x,y){
	
	var pcanvas = document.getElementById("piecanvas");
	var ctx = pcanvas.getContext("2d");
	
	var s=50;
	var ratio1 = document.getElementById("ratio_1").value;
	var r1 =ratio1/s;
	var ratio2 = document.getElementById("ratio_2").value;
	var r2 =ratio2/s;
	var ratio3 = document.getElementById("ratio_3").value;
	var r3 =ratio3/s;
	var ratio4 = document.getElementById("ratio_4").value;
	var r4 =ratio4/s;

	var rsum=r1+r2+r3+r4;
	var rr1=r1/rsum*100;
	var rr2=r2/rsum*100;
	var rr3=r3/rsum*100;
	var rr4=r4/rsum*100;
  
  document.getElementById('phase1per').innerHTML = Math.round(rr1)+"%";
  document.getElementById('phase2per').innerHTML = Math.round(rr2)+"%";
  document.getElementById('phase3per').innerHTML = Math.round(rr3)+"%";
  document.getElementById('phase4per').innerHTML = Math.round(rr4)+"%";

	var lastend = 0;
	//var data = [75,25,0,0];
	var data = [rr1,rr2,rr3,rr4];
	var myTotal = 0;
	var myColor = ['red','blue','magenta','green'];

	var height = pcanvas.height/2;
	var width = pcanvas.width/2;
	var x0=pcanvas.height/2;
	var y0=pcanvas.width/2;
	var radius = pcanvas.height/2*0.9
	//var width = canvas.width/2*0.9+canvas.width/2*0.1;

	for(var e = 0; e < data.length; e++){
  		myTotal += data[e];
	}

	ctx.beginPath();
    ctx.arc(x0, y0, radius, 0, 2 * Math.PI, false);

    ctx.lineWidth = 3;
    ctx.strokeStyle = '#000000';
    ctx.stroke();

	for (var i = 0; i < data.length; i++) {
		ctx.fillStyle = myColor[i];
		ctx.beginPath();
		ctx.moveTo(width,height);
		ctx.arc(x0,y0,radius,lastend,lastend+(Math.PI*2*(data[i]/myTotal)),false);
		ctx.lineTo(width,height);
		ctx.fill();
		lastend += Math.PI*2*(data[i]/myTotal);
	}

};

function oxstate(x,y){
	
	var c=document.getElementById("oxstatecanvas");
	var ctx=c.getContext("2d");
	
	var h=c.height;
	var w=c.width;

	var xspace=(w-100)/4;
	var yspace=(h-100)/1.6;
	
	var x1 = document.getElementById("qshift_1").value;
	var x1scaled=50+(xspace)*x1;
	var y1 = document.getElementById("censhift_1").value;
	var y1scaled=(h-50)-yspace*y1;
	
	var x2 = document.getElementById("qshift_2").value;
	var x2scaled=50+(xspace)*x2;
	var y2 = document.getElementById("censhift_2").value;
	var y2scaled=(h-50)-yspace*y2;
	
	var x3 = document.getElementById("qshift_3").value;
	var x3scaled=50+(xspace)*x3;
	var y3 = document.getElementById("censhift_3").value;
	var y3scaled=(h-50)-yspace*y3;
	
	var x4 = document.getElementById("qshift_4").value;
	var x4scaled=50+(xspace)*x4;
	var y4 = document.getElementById("censhift_4").value;
	var y4scaled=(h-50)-yspace*y4;

ctx.clearRect(0,0,w,h);

// Set axes
ctx.beginPath();
ctx.strokeStyle="black";
ctx.lineWidth="1";
ctx.moveTo(50,50);
ctx.lineTo(50,h-50);
ctx.lineTo(w-50,h-50);
ctx.stroke();


//Axes Tick marks
ctx.beginPath();

	//x-axis
ctx.moveTo(50,h-45);    				ctx.lineTo(50,h-50);
ctx.moveTo(50+xspace/2,h-45);   		ctx.lineTo(50+xspace/2,h-50);
ctx.moveTo(50+xspace,h-45);    			ctx.lineTo(50+xspace,h-50);
ctx.moveTo(50+2*xspace-xspace/2,h-45);   ctx.lineTo(50+2*xspace-xspace/2,h-50);
ctx.moveTo(50+2*xspace,h-45);   		ctx.lineTo(50+2*xspace,h-50);
ctx.moveTo(50+3*xspace-xspace/2,h-45);   ctx.lineTo(50+3*xspace-xspace/2,h-50);
ctx.moveTo(50+3*xspace,h-45);   		ctx.lineTo(50+3*xspace,h-50);
ctx.moveTo(50+4*xspace-xspace/2,h-45);   ctx.lineTo(50+4*xspace-xspace/2,h-50);
ctx.moveTo(50+4*xspace,h-45);   ctx.lineTo(50+4*xspace,h-50);
	//y-axis
ctx.moveTo(45,h-50);    				ctx.lineTo(50,h-50);
ctx.moveTo(45,h-50-yspace+yspace/2);    	ctx.lineTo(50,h-50-yspace+yspace/2);
ctx.moveTo(45,h-50-yspace);    			ctx.lineTo(50,h-50-yspace);
ctx.moveTo(45,h-50-2*yspace+yspace/2);    	ctx.lineTo(50,h-50-2*yspace+yspace/2);
ctx.moveTo(45,h-50-2*yspace);   		ctx.lineTo(50,h-50-2*yspace);
ctx.moveTo(45,h-50-3*yspace+yspace/2);    	ctx.lineTo(50,h-50-3*yspace+yspace/2);
ctx.moveTo(45,h-50-3*yspace);   		ctx.lineTo(50,h-50-3*yspace);

ctx.stroke();

ctx.font="10pt Arial";
ctx.strokeStyle="black";
ctx.fillStyle = "black";
ctx.fillText("\u0394EQ (mm/s)",w/2,h-10);
ctx.fillText("0",45,h-30);
ctx.fillText("1",45+xspace,h-30);
ctx.fillText("2",45+2*xspace,h-30);
ctx.fillText("3",45+3*xspace,h-30);
ctx.fillText("4",45+4*xspace,h-30);

ctx.fillText("\u03B4",10,h/2);
ctx.fillText("(mm/s)",5,h/2+15);
ctx.fillText("0",35,h-45);
ctx.fillText("1",35,h-45-yspace);
ctx.fillText("2",35,h-45-2*yspace);

ctx.fillText("IV Fe(II)",30+xspace*0.30,h-90);
ctx.fillText("VI Fe(III)",80+xspace*0.30,h-150);
ctx.fillText("Fe3+-Fe2+",90+xspace*0.30,h-240);
ctx.fillText("IV Fe(II)",220+xspace*0.30,h-285);
ctx.fillText("VI Fe(II)",280+xspace*0.30,h-325);
ctx.fillText("VIII Fe(II)",350+xspace*0.30,h-353);

ctx.stroke();



// IV Fe3+
ctx.beginPath();
ctx.lineWidth="2";
ctx.strokeStyle="blue";
//For setting the rectangles, (x,y,width,height)
ctx.rect(50+xspace*0.05,(h-50)-yspace*0.08-yspace*(0.17),xspace*0.55,yspace*(0.17)); 
ctx.stroke();

// VI Fe3+
ctx.beginPath();
ctx.lineWidth="2";
ctx.strokeStyle="blue";
//For setting the rectangles, (x,y,height,width)
ctx.rect(50+xspace*0.5,(h-50)-yspace*0.3-yspace*0.2,(xspace)*1.5-xspace*0.5,yspace*0.2); 
ctx.stroke();

// Fe3+-2+
ctx.beginPath();
ctx.lineWidth="2";
ctx.strokeStyle="green";
//For setting the rectangles, (x,y,height,width)
ctx.rect(50+xspace*0.3,(h-50)-yspace*0.65-yspace*0.25,(xspace)*2.0-xspace*0.3,yspace*0.25); 
ctx.stroke();


// IV Fe2+
ctx.beginPath();
ctx.lineWidth="2";
ctx.strokeStyle="red";
//For setting the rectangles, (x,y,height,width)
ctx.rect(50+xspace*1.8,(h-50)-yspace*0.9-yspace*0.15,50+xspace*2.3-xspace*1.8,yspace*0.152); 
ctx.stroke();

// VI Fe2+
ctx.beginPath();
ctx.lineWidth="2";
ctx.strokeStyle="red";
//For setting the rectangles, (x,y,height,width)
ctx.rect(50+xspace*2.0,(h-50)-yspace*1.05-yspace*0.15,50+xspace*3.2-xspace*2.0,yspace*0.15); 
ctx.stroke();

// VIII Fe2+
ctx.beginPath();
ctx.lineWidth="2";
ctx.strokeStyle="red";
//For setting the rectangles, (x,y,height,width)
ctx.rect(50+xspace*3.1,(h-50)-yspace*1.15-yspace*0.15,50+xspace*3.5-xspace*3.1,yspace*0.15); 
ctx.stroke();



// Point 1
ctx.beginPath();
ctx.lineWidth="2";
ctx.strokeStyle="black";
//ctx.fillRect(x1scaled,y1scaled,5,5);
ctx.arc(x1scaled,y1scaled,9,0,2*Math.PI);
ctx.fillStyle = 'yellow';
ctx.font="10pt Arial";
ctx.fill();
ctx.stroke();

ctx.font="10pt Arial";
ctx.strokeStyle="black";
ctx.fillStyle = "black";
ctx.fillText("1",x1scaled-4,y1scaled+4);
ctx.stroke();


// Point 2
ctx.beginPath();
ctx.lineWidth="2";
ctx.strokeStyle="black";
//ctx.fillRect(x2scaled,y2scaled,5,5);
ctx.arc(x2scaled,y2scaled,9,0,2*Math.PI);
ctx.fillStyle = 'yellow';
ctx.fill();
ctx.stroke();
ctx.font="10pt Arial";
ctx.strokeStyle="black";
ctx.fillStyle = "black";
ctx.fillText("2",x2scaled-4,y2scaled+4);
ctx.stroke();

// Point 3
ctx.beginPath();
ctx.lineWidth="2";
ctx.strokeStyle="black";
//ctx.fillRect(x3scaled,y3scaled,5,5);
ctx.arc(x3scaled,y3scaled,9,0,2*Math.PI);
ctx.fillStyle = 'yellow';
ctx.fill();
ctx.stroke();
ctx.font="10pt Arial";
ctx.strokeStyle="black";
ctx.fillStyle = "black";
ctx.fillText("3",x3scaled-4,y3scaled+4);
ctx.stroke();


// Point 4
ctx.beginPath();
ctx.lineWidth="2";
ctx.strokeStyle="black";
//ctx.fillRect(x4scaled,y4scaled,5,5);
ctx.arc(x4scaled,y4scaled,9,0,2*Math.PI);
ctx.fillStyle = 'yellow';
ctx.fill();
ctx.stroke();
ctx.font="10pt Arial";
ctx.strokeStyle="black";
ctx.fillStyle = "black";
ctx.fillText("4",x4scaled-4,y4scaled+4);
ctx.stroke();



}

/* Langevin ************************************

The Langevin function is used to fit magnetic hysteresis loops obtained in a magnetometer such as AGFM or VSM. Typical data shows a negative magnetization which goes through zero.
At the heart of the equation lies the expression: math.coth(x). Coth(x) is not(?) supported in javascript, so instead we can either use the approximation  Coth(x)= (e^x + e^-x)/(e^x - e^-x) or Coth(x)=cosh(x)/sinh(x)

*/

function langevin(x) {
		
		var canvas = document.getElementById("canvas");
	
		var p1 = document.getElementById("p1").value;
		var p2 = document.getElementById("p2").value;
		var p3 = document.getElementById("p3").value;
		var p4 = document.getElementById("p4").value;
		//var p4 = 25000;
		var x = x*p4*10;
        return  (p1*((Math.cosh(p2*x)/Math.sinh(p2*x))-(1/(p2*x)))+p3*x);
					
		}				

	
	/*function clearall(){
			ctx.clearRect(0,0,canvas.width, canvas.height);
	}*/
	

	function lang_sum() {
			var canvas = document.getElementById("canvas");
			var xscale = document.getElementById("slider2").value;
			if (null==canvas || !canvas.getContext) return;

			var axes={}, ctx=canvas.getContext("2d");
			axes.x0 = 0 + 0.5*canvas.width;  // x0 pixels from left to x=0
			axes.y0 = 0 + 0.5*canvas.height; // y0 pixels from top to y=0
			axes.scale = xscale;                 // 40 pixels from x=0 to x=1
			axes.doNegativeX = true;

			langshowAxes(ctx,axes);
			
			//ctx.clearRect(0,0,canvas.width, canvas.height);
			langplot(ctx,axes,langevin,"black",2);

			
	}

	function langplot (ctx,axes,func,color,thick) {
			var xx, yy, dx=0.1, x0=axes.x0, y0=axes.y0, scale=axes.scale;
			var iMax = Math.round((ctx.canvas.width-x0)/dx);
			var iMin = axes.doNegativeX ? Math.round(-x0/dx) : 0;
			
			ctx.beginPath();
			ctx.lineWidth = thick;
			ctx.strokeStyle = color;

				for (var i=iMin;i<=iMax;i++) {
					xx = dx*i; 
					yy = scale*func(xx/scale);
					
					if (i==iMin) ctx.moveTo(x0+xx,y0-yy);
					else         ctx.lineTo(x0+xx,y0-yy);
				}
			ctx.stroke();
			
			
	}

	function langshowAxes(ctx,axes) {
			var x0=axes.x0, w=10*ctx.canvas.width;
			var y0=axes.y0, h=ctx.canvas.height;
			var xscale = document.getElementById("slider2").value;
			var wx=xscale*0.1;
			var xmin = axes.doNegativeX ? 0 : x0;
 			
			ctx.clearRect(0,0,canvas.width, canvas.height);
			
			ctx.beginPath();
			ctx.strokeStyle = "black"; 
			ctx.moveTo(xmin,y0); ctx.lineTo(w,y0);  // X axis
			ctx.stroke();

			ctx.beginPath();
			ctx.strokeStyle = "black"; 
			ctx.moveTo(0.5*canvas.width,canvas.height); ctx.lineTo(0.5*canvas.width,0);  // X axis
			
			ctx.stroke();

	}

/* XMCD ************************************ 

Introduction:
*****************
X-ray magnetic circular dichroism (XMCD) is a technique used at specialized synchrotron facilities for determining the stoichiometry (i.e. Fe(II) and Fe(III)) content of magnetic minerals, commonly magnetite.
The fitting of the data relies on sum rules.

References:
*****************
van der Laan 1991 << need to check
van der Laan 1990 << need to check
*****************
*/

function xmcd(x,y){
		
		var canvasxmcd = document.getElementById("canvas");
		var ctx = canvasxmcd.getContext("2d");
		
		ctx.clearRect(0,0,canvasxmcd.width, canvasxmcd.height);
	
		var y1=[-0.000270637829,	-0.000274812483,	-0.000279085973,	-0.000283452537,	-0.0002879237,	-0.000292499579,	-0.000297180086,	-0.000301965221,	-0.000306872476,	-0.00031189021,	-0.000317030033,	-0.000322297798,	-0.000327693473,	-0.000333222852,	-0.000338885991,	-0.000344694476,	-0.000350654096,	-0.00035676494,	-0.000363032741,	-0.00036946917,	-0.000376074167,	-0.000382853643,	-0.000389813329,	-0.000396970776,	-0.000404320017,	-0.000411872781,	-0.000419646502,	-0.000427635328,	-0.000435850932,	-0.000444310717,	-0.000453020504,	-0.000461991964,	-0.000471230887,	-0.000480754708,	-0.000490569219,	-0.000500691938,	-0.000511140213,	-0.000521919865,	-0.000533048413,	-0.000544549082,	-0.000556439336,	-0.000568724936,	-0.000581440749,	-0.000594592711,	-0.000608221395,	-0.000622332678,	-0.000636967248,	-0.000652142509,	-0.000667893502,	-0.000684249098,	-0.000701244222,	-0.000718919677,	-0.000737310271,	-0.000756456808,	-0.000776411383,	-0.000797220797,	-0.000818942965,	-0.000841630332,	-0.000865352573,	-0.000890179654,	-0.000916192774,	-0.000943467603,	-0.000972097216,	-0.00100219203,	-0.00103385653,	-0.00106722489,	-0.00110241876,	-0.00113960693,	-0.00117894635,	-0.00122064061,	-0.0012648874,	-0.00131194247,	-0.00136206753,	-0.0014155648,	-0.00147278327,	-0.00153412402,	-0.00160002324,	-0.00167100993,	-0.0017476714,	-0.0018306995,	-0.00192088482,	-0.00201916974,	-0.00212662364,	-0.00224454328,	-0.00237443438,	-0.00251807668,	-0.00267761503,	-0.00285558449,	-0.00305502629,	-0.00327962684,	-0.00353375776,	-0.00382272224,	-0.00415282883,	-0.00453156559,	-0.00496766064,	-0.00547099859,	-0.00605217135,	-0.00672157109,	-0.00748735946,	-0.00835242216,	-0.00931014027,	-0.0103402697,	-0.0114060929,	-0.0124533456,	-0.0134092038,	-0.0141826561,	-0.0146733131,	-0.0147959245,	-0.0145145357,	-0.0138643524,	-0.0129426587,	-0.011872963,	-0.0107663879,	-0.00970212743,	-0.00873037986,	-0.00788672548,	-0.00720556406,	-0.00672464119,	-0.00647741137,	-0.00647738809,	-0.00670537772,	-0.00710941898,	-0.00761756487,	-0.00815517176,	-0.00865775906,	-0.00907821395,	-0.00939219166,	-0.00960313436,	-0.00974219386,	-0.00985913724,	-0.0100077791,	-0.0102329031,	-0.0105634863,	-0.0110121919,	-0.0115786437,	-0.0122548165,	-0.0130338911,	-0.0139222518,	-0.014952573,	-0.0161941033,	-0.0177583117,	-0.0197979938,	-0.0224969368,	-0.0260482635,	-0.0306217559,	-0.0363241285,	-0.0431604199,	-0.0510046743,	-0.0595783852,	-0.0684277639,	-0.0769070089,	-0.0842032582,	-0.0894571543,	-0.0919833854,	-0.0915033892,	-0.0882429257,	-0.0828248262,	-0.0760320276,	-0.0685888529,	-0.0610572621,	-0.0538409501,	-0.0472302884,	-0.0414374731,	-0.0366071053,	-0.0328107215,	-0.0300406422,	-0.0282142796,	-0.0271929298,	-0.0268076453,	-0.0268855039,	-0.0272747613,	-0.0278681777,	-0.0286156293,	-0.0295221917,	-0.0306366812,	-0.0320309736,	-0.0337582715,	-0.0357894078,	-0.0379606672,	-0.0399744064,	-0.0414641723,	-0.0421010479,	-0.0417007692,	-0.0402839743,	-0.0380541086,	-0.0353046991,	-0.0323155187,	-0.029289959,	-0.0263469275,	-0.0235450435,	-0.0209105704,	-0.0184547603,	-0.0161808711,	-0.0140860276,	-0.012161172,	-0.0103915175,	-0.00875871256,	-0.00724349637,	-0.00582864089,	-0.00450087804,	-0.00325306715,	-0.00208644685,	-0.00101151224,	-0.0000445316582,	0.00080078491,	0.00152130355,	0.00212603644,	0.00263147289,	0.00305540441,	0.0034128204,	0.00371331489,	0.00395938708,	0.0041469913,	0.00427017827,	0.00432831002,	0.00433065277,	0.00429495284,	0.00424195034,	0.00419018511,	0.00415282277,	0.00413624616,	0.0041397349,	0.00415684655,	0.0041789813,	0.0042003952,	0.00422156509,	0.00424855482,	0.00428876095,	0.00434620026,	0.00441955915,	0.00450426759,	0.00459673814,	0.00469651725,	0.00480411621,	0.00491641369,	0.00502305944,	0.00510591315,	0.00514228735,	0.00511282589,	0.00501097133,	0.00484713633,	0.00464442698,	0.00442967005,	0.00422578026,	0.0040473924,	0.00389916846,	0.0037763766,	0.00366791105,	0.00356102688,	0.00344552589,	0.00331507646,	0.00316559104,	0.00299352268,	0.00279647089,	0.00257569621,	0.0023376476,	0.00209265645,	0.00185191573,	0.00162470492,	0.00141708821,	0.00123189134,	0.00106944586,	0.000928513298,	0.000807029486,	0.000702662976,	0.000613111188,	0.000536269567,	0.000470300613,	0.000413628703,	0.000364916545,	0.000323053653,	0.000287127157,	0.000256363739,	0.000230147096,	0.000207965568,	0.000189412181,	0.000174167115,	0.000161991979,	0.000152706561,	0.000146211984,	0.000142461766,	0.000141467521,	0.000143264144,	0.000147921382,	0.000155474147,	0.000165846854,	0.000178737129,	0.000193429849,	0.000208657468,	0.000222501316,	0.000232664694,	0.000237031229,	0.000234472944,	0.00022532705,	0.000211233215,	0.000194395019,	0.000176894013,	0.000160212803,	0.000145235186,	0.000132327463,	0.000121553581,	0.00011277981,	0.000105808474,	0.00010042444,	0.0000964067658,	0.0000935577627,	0.0000917204452,	0.0000907552749,	0.0000905343331,	0.0000909587761,	0.0000919472077,	0.0000934356649,	0.0000953660128,	0.0000976859083,	0.000100360485,	0.000103349033,	0.000106634106,	0.000110180823,	0.000113977556,	0.000118001044,	0.000122245474,	0.000126693412,	0.000131339038,	0.000136170696,	0.000141182623,	0.000146368984,	0.000151723943,	0.000157247516,	0.00016293388,	0.000168788887,	0.000174800865,	0.000180975636,	0.000187319034,	0.000193819404,	0.00020048258,	0.00020732019,	0.000214320593,	0.000221495429,	0.000228844685,	0.00023637421,	0.000244089781,	0.000251985592,	0.000260084897,	0.000268376054,	0.000276870764,	0.000285580551,	0.000294505473,	0.000303657172,	0.00031304147,	0.000322664098,	0.000332536787,	0.000342676911,	0.000353078649,	0.000363765314,	0.000374742696,	0.000386022439,	0.000397616124,	0.000409541244,	0.000421809411,	0.000434438029,	0.000447438797,	0.000460834941,	0.000474638073,	0.000488871476,	0.000503546733,	0.000518698769,	0.000534339226,	0.000550502911,	0.000567201583,	0.000584475871,	0.00060234894,	0.000620850013,	0.000640013895,	0.000659875572,	0.000680475612,	0.000701854762,	0.000724053767,	0.000747119018,	0.00077109714,	0.000796046283,	0.000822024536,	0.000849090051,	0.000877306855,	0.000906750385,	0.00093749637,	0.000969626126,	0.00100323278,	0.00103840919,	0.00107526022,	0.00111390196,	0.00115445664,	0.00119705219,	0.00124184543,	0.00128897605,	0.00133863592,	0.00139099953,	0.00144627586,	0.00150469213,	0.00156648061,	0.00163191464,	0.0017012849,	0.00177490548,	0.00185313681,	0.00193634501,	0.00202496652,	0.00211943709,	0.00222026277,	0.0023279842,	0.00244320021,	0.00256652711,	0.00269867433,	0.00284036272,	0.0029923832,	0.00315555558,	0.00333073456,	0.00351878023,	0.00372057687,	0.00393691519,	0.00416857377,	0.00441612909,	0.00468003377,	0.00496039307,	0.00525700301,	0.00556914322,	0.00589558715,	0.00623440277,	0.00658298749,	0.00693793222,	0.0072951219,	0.00764965406,	0.00799611583,	0.00832857657,	0.00864095613,	0.00892732106,	0.00918219052,	0.00940104015,	0.0095806038,	0.00971924514,	0.00981711131,	0.00987617858,	0.0099000698,	0.00989374984,	0.0098631205,	0.00981457625,	0.00975462608,	0.00968954619,	0.00962522253,	0.00956706144,	0.00952010602,	0.00948902313,	0.00947835855,	0.0094924299,	0.00953536201,	0.00961085502,	0.00972197764,	0.00987077132,	0.0100579513,	0.0102826506,	0.0105421068,	0.0108316178,	0.0111442991,	0.0114713171,	0.0118019069,	0.0121238967,	0.0124241989,	0.012689773,	0.012908495,	0.01307033,	0.0131681962,	0.0131986095,	0.0131619573,	0.0130622182,	0.0129063614,	0.0127034253,	0.0124635557,	0.012197122,	0.0119139776,	0.0116230883,	0.0113321645,	0.0110477125,	0.0107748937,	0.0105176754,	0.0102788238,	0.010060044,	0.00986201596,	0.0096845394,	0.00952660665,	0.00938655064,	0.00926215481,	0.00915079936,	0.00904959533,	0.00895553827,	0.00886567216,	0.00877727196,	0.0086879991,	0.00859619211,	0.00850092992,	0.00840224419,	0.00830105226,	0.00819908641,	0.00809862185,	0.00800214522,	0.00791195408,	0.00782985054,	0.00775683438,	0.00769304018,	0.00763772894,	0.00758952834,	0.0075466889,	0.00750741875,	0.00747013791,	0.00743369944,	0.00739743561,	0.0073611429,	0.00732496055,	0.00728916796,	0.00725402636,	0.0072196289,	0.00718574366,	0.00715177646,	0.00711678015,	0.00707943505,	0.0070381593,	0.00699116196,	0.00693656597,	0.00687247515,	0.00679710461,	0.00670883199,	0.00660636649,	0.00648875488,	0.00635553245,	0.00620670943,	0.00604285719,	0.00586500391,	0.00567468442,	0.00547377206,	0.00526448619,	0.0050492119,	0.00483045541,	0.00461068656,	0.00439229608,	0.00417742878,	0.00396798085,	0.00376547477,	0.00357112638,	0.00338574336,	0.00320987869,	0.00304374681,	0.00288737728,	0.00274058385,	0.00260306988,	0.00247442862,	0.00235421257,	0.00224192091,	0.00213704864,	0.00203908351,	0.00194754929,	0.00186196866,	0.00178190006,	0.00170692476,	0.00163665332,	0.00157073082,	0.0015088144,	0.00145061337,	0.00139583112,	0.00134422351,	0.00129554037,	0.00124957843,	0.0012061341,	0.00116502703,	0.00112608878,	0.00108917383,	0.0010541369,	0.00102085003,	0.000989197055,	0.000959073193,	0.000930373848,	0.000903011824,	0.000876899867,	0.000851962308,	0.00082812953,	0.000805331743,	0.000783504802,	0.000762602431,	0.000742560602,	0.000723332749,	0.000704878243,	0.000687156222,	0.000670120353,	0.000653735711,	0.000637967314,	0.000622792053,	0.000608169124,	0.000594069425,	0.000580481428,	0.00056736439,	0.000554700848,	0.000542473397,	0.000530658755,	0.000519233698,	0.000508186524,	0.00049749983,	0.000487156212,	0.000477138208,	0.000467434147,	0.000458026625,	0.000448909792,	0.000440066302,	0.000431484397,	0.000423158315,	0.000415076473,	0.000407227169,	0.000399598823,	0.000392185582,	0.000384981686,	0.000377975462,	0.000371161092,	0.00036453284,	0.000358078949,	0.000351799536,	0.000345682871,	0.00033972325,	0.000333920587,	0.000328263297,	0.000322751293,	0.000317373109,	0.000312128599,	0.00030701785,	0.000302023371,	0.000297156832,	0.000292400713,	0.000287760922,	0.00028323158,	0.000278801075,	0.000274481077,	0.000270254095,	0.00026612595,	0.00026209082,	0.000258142914,	0.000254282233,	0.000250508747,	0.000246816664,	0.000243205999,	0.000239670917,	0.000236211403,	0.00023282168,	0.000229507539,	0.000226263146,	0.000223082723,	0.00021996627,	0.00021691958,	0.000213925232,	0.000211000632,	0.000208128375,	0.000205314267,	0.000202552474,	0.00019984883,	0.000197197514,	0.000194598528,	0.000192046049,	0.000189540093,	0.000187086451,	0.000184673525,	0.000182307107,	0.000179987212,	0.000177708003,	0.000175469497,	0.000173277513,	0.000171120424,	0.000168998202,	0.000166916681,	0.000164875863,	0.000162869939,	0.000160893076,	0.000158956915,	0.000157049828,	0.000155177637,	0.000153340312,	0.000151532062,	0.000149752887,	0.000148002786,	0.000146287566,	0.000144595615,	0.000142932724,	0.000141293101,	0.000139688345,	0.000138101052,	0.000136548639,	0.000135013659,	0.000133507754,	0.000132025118,	0.000130565735,	0.000129123786,	0.000127710911,	0.000126315485,	0.000124949132,	0.000123594393,	0.000122268742,	0.000120960518,	0.000119669749,	0.000118402233,	0.000117146345,	0.000115913717,	0.000114704337,	0.000113506598,	0.000112326299,	0.000111169255,	0.000110023844,	0.000108895867,	0.000107785338,	0.000106692249,	0.000105610794,	0.000104546772,	0.000103500199,	0.000102465259,	0.000101447753,	0.000100441888,	0.0000994476359,	0.0000984708458,	0.0000975056682,	0.0000965579457,	0.0000956218355,	0.0000946915534,	0.0000937845252,	0.0000928833033,	0.0000919937229,	0.0000911157622,	0.000090255242,	0.0000894005498,	0.0000885574773,	0.0000877260318,	0.0000869062133,	0.000086098029,	0.0000853014644,	0.0000845107279,	0.0000837374246,	0.0000829699347,	0.0000822082657,	0.0000814582236,	0.0000807198085,	0.0000799930276,	0.0000792720457,	0.0000785627126,	0.0000778591784,	0.000077161465,	0.0000764811921,	0.0000758009191,	0.0000751322732,	0.0000744752615,	0.000073824056];
		var y2=[0.00017752,	0.00018009,	0.00018271,	0.00018538,	0.0001881,	0.00019088,	0.00019371,	0.0001966,	0.00019955,	0.00020255,	0.00020562,	0.00020875,	0.00021194,	0.0002152,	0.00021852,	0.00022192,	0.00022538,	0.00022892,	0.00023253,	0.00023622,	0.00023999,	0.00024384,	0.00024777,	0.00025179,	0.0002559,	0.0002601,	0.00026439,	0.00026878,	0.00027326,	0.00027785,	0.00028255,	0.00028735,	0.00029226,	0.00029729,	0.00030243,	0.0003077,	0.00031309,	0.00031862,	0.00032427,	0.00033007,	0.000336,	0.00034209,	0.00034832,	0.00035471,	0.00036126,	0.00036798,	0.00037488,	0.00038195,	0.0003892,	0.00039665,	0.00040429,	0.00041214,	0.0004202,	0.00042848,	0.00043699,	0.00044573,	0.00045471,	0.00046396,	0.00047346,	0.00048323,	0.00049329,	0.00050365,	0.0005143,	0.00052528,	0.00053659,	0.00054824,	0.00056025,	0.00057263,	0.0005854,	0.00059858,	0.00061218,	0.00062622,	0.00064072,	0.0006557,	0.00067118,	0.00068719,	0.00070375,	0.00072088,	0.00073862,	0.00075699,	0.00077603,	0.00079576,	0.00081623,	0.00083747,	0.00085952,	0.00088243,	0.00090623,	0.000931,	0.00095677,	0.0009836,	0.00101156,	0.00104073,	0.00107116,	0.00110295,	0.00113617,	0.00117093,	0.00120734,	0.00124549,	0.00128553,	0.00132759,	0.00137183,	0.00141841,	0.00146754,	0.00151941,	0.00157427,	0.00163238,	0.00169406,	0.00175964,	0.00182951,	0.00190413,	0.00198401,	0.00206974,	0.00216201,	0.00226164,	0.00236955,	0.00248688,	0.00261492,	0.00275526,	0.00290976,	0.00308065,	0.00327065,	0.00348298,	0.00372154,	0.00399098,	0.00429681,	0.00464541,	0.00504394,	0.00549997,	0.00602047,	0.00660994,	0.00726694,	0.00797842,	0.00871187,	0.00940683,	0.00997103,	0.01029017,	0.01025905,	0.00982824,	0.00903996,	0.00802379,	0.00695131,	0.00598155,	0.00522797,	0.00475024,	0.00455777,	0.00461806,	0.00487154,	0.00525083,	0.00569721,	0.00616927,	0.00664473,	0.00711947,	0.00760681,	0.00813865,	0.00876828,	0.00957482,	0.01066705,	0.01218127,	0.01426523,	0.0170478,	0.02061013,	0.02498139,	0.03016569,	0.03618012,	0.04307497,	0.05091879,	0.05975221,	0.06953648,	0.08012944,	0.09130615,	0.10280889,	0.11437876,	0.12572551,	0.13645051,	0.14600454,	0.15375589,	0.15915251,	0.16187215,	0.16185065,	0.15918419,	0.15399782,	0.14639245,	0.13651885,	0.12470026,	0.11147479,	0.09751295,	0.08347206,	0.06987296,	0.05704024,	0.04510339,	0.03403704,	0.02372017,	0.01399955,	0.00474696,	-0.00409463,	-0.01248085,	-0.02026112,	-0.02721866,	-0.03314862,	-0.0379348,	-0.04156648,	-0.0440877,	-0.04553325,	-0.04589973,	-0.04515468,	-0.04327486,	-0.0403122,	-0.03645763,	-0.03204567,	-0.02747927,	-0.02312055,	-0.01921314,	-0.0158681,	-0.01310008,	-0.01087366,	-0.00912974,	-0.00779446,	-0.00678773,	-0.00603539,	-0.00547662,	-0.00506348,	-0.00475761,	-0.00452879,	-0.00435583,	-0.00422705,	-0.00413788,	-0.00408594,	-0.00406657,	-0.0040715,	-0.00409119,	-0.00411912,	-0.00415508,	-0.00420486,	-0.00427685,	-0.00437827,	-0.00451367,	-0.00468655,	-0.00490218,	-0.00516837,	-0.00549211,	-0.00587394,	-0.0063045,	-0.00676656,	-0.0072423,	-0.00772181,	-0.00820727,	-0.00871006,	-0.00924452,	-0.00982458,	-0.0104648,	-0.01118118,	-0.01198582,	-0.01287541,	-0.0138194,	-0.01475619,	-0.01560378,	-0.01628338,	-0.01674323,	-0.01696514,	-0.01695191,	-0.01671374,	-0.0162707,	-0.0156648,	-0.01496116,	-0.01423007,	-0.01352239,	-0.0128554,	-0.01221624,	-0.0115797,	-0.01092895,	-0.01026641,	-0.00960922,	-0.00897615,	-0.00837822,	-0.00781822,	-0.0072951,	-0.00680643,	-0.00634728,	-0.00590963,	-0.00548491,	-0.00506869,	-0.00466321,	-0.00427603,	-0.00391601,	-0.00359005,	-0.00330163,	-0.00305122,	-0.00283725,	-0.00265718,	-0.00250816,	-0.00238761,	-0.00229333,	-0.00222372,	-0.00217777,	-0.00215509,	-0.00215588,	-0.00218094,	-0.00223158,	-0.00230944,	-0.00241626,	-0.0025532,	-0.00272002,	-0.00291355,	-0.00312621,	-0.003345,	-0.00355257,	-0.00373183,	-0.0038726,	-0.00397594,	-0.00405079,	-0.00410459,	-0.00413602,	-0.00413589,	-0.00409388,	-0.00400412,	-0.00386578,	-0.00368141,	-0.0034569,	-0.00320255,	-0.0029327,	-0.00266267,	-0.00240531,	-0.002169,	-0.0019577,	-0.00177202,	-0.00161058,	-0.00147095,	-0.00135044,	-0.00124637,	-0.00115634,	-0.00107825,	-0.00101028,	-0.00095093,	-0.00089893,	-0.00085322,	-0.00081292,	-0.00077728,	-0.00074569,	-0.00071763,	-0.00069266,	-0.0006704,	-0.00065055,	-0.00063283,	-0.00061702,	-0.0006029,	-0.00059032,	-0.00057912,	-0.00056917,	-0.00056036,	-0.00055259,	-0.00054578,	-0.00053984,	-0.00053471,	-0.00053033,	-0.00052665,	-0.00052362,	-0.00052119,	-0.00051934,	-0.00051802,	-0.00051721,	-0.00051689,	-0.00051702,	-0.00051758,	-0.00051857,	-0.00051995,	-0.00052172,	-0.00052386,	-0.00052637,	-0.00052922,	-0.00053241,	-0.00053593,	-0.00053978,	-0.00054395,	-0.00054844,	-0.00055323,	-0.00055833,	-0.00056373,	-0.00056944,	-0.00057544,	-0.00058175,	-0.00058836,	-0.00059526,	-0.00060247,	-0.00060998,	-0.0006178,	-0.00062593,	-0.00063437,	-0.00064312,	-0.00065219,	-0.00066159,	-0.00067132,	-0.00068139,	-0.00069179,	-0.00070255,	-0.00071367,	-0.00072514,	-0.000737,	-0.00074923,	-0.00076186,	-0.00077488,	-0.00078832,	-0.00080219,	-0.00081649,	-0.00083124,	-0.00084645,	-0.00086213,	-0.00087831,	-0.00089499,	-0.0009122,	-0.00092994,	-0.00094824,	-0.00096711,	-0.00098658,	-0.00100666,	-0.00102738,	-0.00104875,	-0.0010708,	-0.00109355,	-0.00111703,	-0.00114127,	-0.00116628,	-0.0011921,	-0.00121876,	-0.00124628,	-0.0012747,	-0.00130405,	-0.00133435,	-0.00136565,	-0.00139797,	-0.00143136,	-0.00146584,	-0.00150145,	-0.00153823,	-0.00157623,	-0.00161546,	-0.00165598,	-0.00169782,	-0.00174102,	-0.00178561,	-0.00183165,	-0.00187918,	-0.00192823,	-0.00197886,	-0.00203112,	-0.00208508,	-0.00214082,	-0.00219844,	-0.00225807,	-0.00231989,	-0.00238411,	-0.00245107,	-0.00252118,	-0.00259501,	-0.00267335,	-0.00275724,	-0.00284807,	-0.00294763,	-0.00305831,	-0.00318308,	-0.0033257,	-0.0034907,	-0.00368347,	-0.00391009,	-0.0041772,	-0.00449155,	-0.0048595,	-0.00528628,	-0.00577535,	-0.00632771,	-0.00694164,	-0.0076126,	-0.00833386,	-0.00909707,	-0.00989352,	-0.0107147,	-0.011553,	-0.0124019,	-0.01325544,	-0.01410783,	-0.01495241,	-0.0157813,	-0.01658466,	-0.01735101,	-0.01806736,	-0.0187204,	-0.0192973,	-0.01978734,	-0.02018273,	-0.02047975,	-0.02067883,	-0.02078453,	-0.02080481,	-0.02075013,	-0.02063242,	-0.02046418,	-0.02025791,	-0.02002575,	-0.01977954,	-0.01953092,	-0.01929164,	-0.01907351,	-0.01888854,	-0.01874858,	-0.01866515,	-0.01864887,	-0.01870912,	-0.01885361,	-0.019088,	-0.01941566,	-0.01983742,	-0.0203515,	-0.02095339,	-0.02163589,	-0.02238882,	-0.02319909,	-0.0240502,	-0.02492204,	-0.02579089,	-0.02662932,	-0.02740711,	-0.02809226,	-0.02865311,	-0.02906046,	-0.02929027,	-0.02932591,	-0.02915988,	-0.02879462,	-0.02824224,	-0.02752321,	-0.02666412,	-0.02569537,	-0.02464824,	-0.02355307,	-0.02243704,	-0.02132357,	-0.02023134,	-0.01917472,	-0.01816364,	-0.01720459,	-0.0163008,	-0.01545334,	-0.01466135,	-0.01392295,	-0.01323536,	-0.01259559,	-0.01200038,	-0.01144661,	-0.01093122,	-0.01045133,	-0.01000414,	-0.00958703,	-0.00919735,	-0.00883259,	-0.00849024,	-0.00816798,	-0.00786353,	-0.00757491,	-0.00730028,	-0.00703818,	-0.00678741,	-0.00654714,	-0.0063169,	-0.00609646,	-0.00588593,	-0.00568548,	-0.0054954,	-0.00531589,	-0.00514704,	-0.00498873,	-0.00484058,	-0.00470193,	-0.00457186,	-0.00444918,	-0.00433248,	-0.00422021,	-0.00411081,	-0.00400277,	-0.00389479,	-0.00378588,	-0.00367545,	-0.00356332,	-0.00344972,	-0.00333517,	-0.00322045,	-0.00310641,	-0.00299394,	-0.00288385,	-0.00277684,	-0.00267342,	-0.002574,	-0.00247881,	-0.00238799,	-0.00230154,	-0.00221941,	-0.00214147,	-0.00206759,	-0.00199756,	-0.00193119,	-0.00186827,	-0.00180861,	-0.001752,	-0.00169824,	-0.00164716,	-0.00159858,	-0.00155234,	-0.00150828,	-0.00146627,	-0.00142617,	-0.00138786,	-0.00135124,	-0.00131619,	-0.00128262,	-0.00125045,	-0.00121958,	-0.00118995,	-0.00116148,	-0.00113411,	-0.00110777,	-0.00108242,	-0.001058,	-0.00103445,	-0.00101174,	-0.00098982,	-0.00096866,	-0.00094821,	-0.00092845,	-0.00090933,	-0.00089083,	-0.00087292,	-0.00085558,	-0.00083878,	-0.00082249,	-0.00080669,	-0.00079137,	-0.0007765,	-0.00076206,	-0.00074803,	-0.00073441,	-0.00072117,	-0.00070829,	-0.00069577,	-0.00068359,	-0.00067174,	-0.0006602,	-0.00064897,	-0.00063803,	-0.00062737,	-0.00061698,	-0.00060686,	-0.00059698,	-0.00058736,	-0.00057796,	-0.0005688,	-0.00055986,	-0.00055113,	-0.0005426,	-0.00053428,	-0.00052615,	-0.0005182,	-0.00051044,	-0.00050285,	-0.00049543,	-0.00048818,	-0.00048109,	-0.00047415,	-0.00046736,	-0.00046072,	-0.00045422,	-0.00044786,	-0.00044163,	-0.00043553,	-0.00042956,	-0.00042371,	-0.00041798,	-0.00041236,	-0.00040686,	-0.00040147,	-0.00039619,	-0.000391,	-0.00038592,	-0.00038094,	-0.00037606,	-0.00037126,	-0.00036656,	-0.00036195,	-0.00035742,	-0.00035298,	-0.00034862,	-0.00034434,	-0.00034014,	-0.00033601,	-0.00033196,	-0.00032798,	-0.00032407,	-0.00032023,	-0.00031646,	-0.00031276,	-0.00030912,	-0.00030554,	-0.00030202,	-0.00029856,	-0.00029516,	-0.00029182,	-0.00028854,	-0.00028531,	-0.00028213,	-0.000279,	-0.00027593,	-0.00027291,	-0.00026993,	-0.00026701,	-0.00026413,	-0.00026129,	-0.0002585,	-0.00025576,	-0.00025305,	-0.00025039,	-0.00024778,	-0.0002452,	-0.00024266,	-0.00024016,	-0.0002377,	-0.00023527,	-0.00023288,	-0.00023053,	-0.00022821,	-0.00022593,	-0.00022368,	-0.00022146,	-0.00021927,	-0.00021712,	-0.000215,	-0.00021291,	-0.00021085,	-0.00020881,	-0.00020681,	-0.00020483,	-0.00020289,	-0.00020097,	-0.00019907,	-0.00019721,	-0.00019536,	-0.00019355,	-0.00019176,	-0.00018999,	-0.00018824,	-0.00018652,	-0.00018483,	-0.00018315,	-0.0001815];
		var y3=[-0.00017471,	-0.00017727,	-0.00017988,	-0.00018254,	-0.00018525,	-0.00018802,	-0.00019085,	-0.00019373,	-0.00019667,	-0.00019967,	-0.00020274,	-0.00020586,	-0.00020906,	-0.00021232,	-0.00021565,	-0.00021905,	-0.00022252,	-0.00022607,	-0.00022969,	-0.0002334,	-0.00023719,	-0.00024106,	-0.00024501,	-0.00024906,	-0.0002532,	-0.00025743,	-0.00026176,	-0.00026619,	-0.00027073,	-0.00027537,	-0.00028012,	-0.00028498,	-0.00028997,	-0.00029507,	-0.00030029,	-0.00030565,	-0.00031114,	-0.00031676,	-0.00032253,	-0.00032844,	-0.00033451,	-0.00034073,	-0.00034711,	-0.00035367,	-0.00036039,	-0.0003673,	-0.00037439,	-0.00038167,	-0.00038916,	-0.00039685,	-0.00040476,	-0.00041289,	-0.00042125,	-0.00042986,	-0.00043871,	-0.00044782,	-0.00045721,	-0.00046687,	-0.00047683,	-0.00048709,	-0.00049767,	-0.00050858,	-0.00051983,	-0.00053145,	-0.00054343,	-0.00055581,	-0.0005686,	-0.00058182,	-0.00059548,	-0.00060961,	-0.00062423,	-0.00063936,	-0.00065503,	-0.00067127,	-0.00068809,	-0.00070554,	-0.00072365,	-0.00074244,	-0.00076195,	-0.00078223,	-0.00080331,	-0.00082523,	-0.00084806,	-0.00087183,	-0.0008966,	-0.00092244,	-0.0009494,	-0.00097755,	-0.00100697,	-0.00103774,	-0.00106994,	-0.00110367,	-0.00113904,	-0.00117615,	-0.00121512,	-0.0012561,	-0.00129922,	-0.00134464,	-0.00139255,	-0.00144313,	-0.0014966,	-0.00155319,	-0.00161317,	-0.00167681,	-0.00174446,	-0.00181646,	-0.00189322,	-0.00197519,	-0.00206288,	-0.00215686,	-0.00225779,	-0.00236639,	-0.0024835,	-0.00261009,	-0.00274726,	-0.00289627,	-0.00305857,	-0.00323588,	-0.00343017,	-0.00364376,	-0.00387939,	-0.00414032,	-0.00443044,	-0.00475445,	-0.00511811,	-0.00552858,	-0.00599491,	-0.00652872,	-0.00714525,	-0.00786455,	-0.00871273,	-0.00972234,	-0.01092974,	-0.01236701,	-0.01404605,	-0.01593758,	-0.01795393,	-0.01994956,	-0.02175,	-0.02320755,	-0.02426098,	-0.02496041,	-0.02543442,	-0.02581613,	-0.02617169,	-0.02646656,	-0.02658265,	-0.02638069,	-0.02578336,	-0.02483186,	-0.02367486,	-0.02249838,	-0.0214496,	-0.02059918,	-0.0199437,	-0.01942667,	-0.01896363,	-0.01846832,	-0.01787785,	-0.01717088,	-0.01637437,	-0.01555981,	-0.01483038,	-0.01429784,	-0.01405381,	-0.01414757,	-0.01458285,	-0.01533397,	-0.01636898,	-0.01766708,	-0.01922522,	-0.02105778,	-0.02319502,	-0.0256839,	-0.02859094,	-0.03200645,	-0.03604952,	-0.04087238,	-0.04666181,	-0.05363197,	-0.06200043,	-0.07193125,	-0.08342423,	-0.09614345,	-0.10923652,	-0.12127349,	-0.13045761,	-0.13512944,	-0.13435912,	-0.12827559,	-0.11792933,	-0.10483275,	-0.09050902,	-0.07624252,	-0.06299778,	-0.05140285,	-0.04176416,	-0.03411655,	-0.0282964,	-0.02399874,	-0.02082906,	-0.01838021,	-0.0163179,	-0.01442382,	-0.01257826,	-0.01071534,	-0.00879131,	-0.00677705,	-0.00466097,	-0.00244633,	-0.00014242,	0.00224028,	0.00468261,	0.00713903,	0.00952109,	0.01169707,	0.01351844,	0.01486844,	0.01570639,	0.01607762,	0.01608626,	0.01585586,	0.01549925,	0.01509957,	0.01469975,	0.01430434,	0.01389728,	0.01346752,	0.01302591,	0.0126016,	0.01222533,	0.0119169,	0.01168624,	0.01154099,	0.01148762,	0.01152228,	0.01162041,	0.01173759,	0.01182688,	0.01186282,	0.01185211,	0.01182034,	0.01178521,	0.01173806,	0.01164775,	0.01148393,	0.01124207,	0.0109515,	0.01066149,	0.01041763,	0.01024491,	0.01014659,	0.01011674,	0.01015572,	0.01027554,	0.01048992,	0.01079593,	0.01116075,	0.0115231,	0.0118106,	0.01196438,	0.01195556,	0.01178271,	0.01145683,	0.01099184,	0.01040948,	0.00974921,	0.00906839,	0.00842945,	0.00788224,	0.0074515,	0.00713469,	0.00691035,	0.00675145,	0.00663495,	0.00654252,	0.00645493,	0.006348,	0.0061965,	0.00598588,	0.00572417,	0.00544278,	0.00518223,	0.00497098,	0.00481296,	0.00469222,	0.00458872,	0.00449069,	0.00439524,	0.00430148,	0.00420434,	0.00409379,	0.00395953,	0.00379734,	0.00361257,	0.00341808,	0.00322934,	0.00305965,	0.00291829,	0.00281051,	0.00273881,	0.00270406,	0.00270637,	0.00274543,	0.00282045,	0.00292966,	0.00306977,	0.00323563,	0.00342092,	0.00362027,	0.00383217,	0.0040605,	0.00431296,	0.00459616,	0.00490965,	0.00524099,	0.00556439,	0.00584398,	0.00604241,	0.0061304,	0.0060926,	0.00592783,	0.00564765,	0.00527554,	0.00484412,	0.00438891,	0.00394072,	0.00352119,	0.00314208,	0.00280746,	0.00251637,	0.00226525,	0.0020494,	0.00186405,	0.0017047,	0.00156739,	0.00144869,	0.00134576,	0.00125616,	0.00117791,	0.00110933,	0.00104903,	0.00099587,	0.00094886,	0.00090721,	0.00087023,	0.00083734,	0.00080805,	0.00078195,	0.00075868,	0.00073793,	0.00071944,	0.00070298,	0.00068835,	0.00067539,	0.00066393,	0.00065385,	0.00064504,	0.00063739,	0.0006308,	0.00062522,	0.00062056,	0.00061675,	0.00061376,	0.00061152,	0.00061,	0.00060916,	0.00060896,	0.00060937,	0.00061037,	0.00061193,	0.00061404,	0.00061667,	0.00061981,	0.00062344,	0.00062756,	0.00063215,	0.00063721,	0.00064273,	0.0006487,	0.00065513,	0.000662,	0.00066933,	0.0006771,	0.00068533,	0.00069401,	0.00070315,	0.00071275,	0.00072283,	0.00073338,	0.00074441,	0.00075595,	0.00076799,	0.00078055,	0.00079365,	0.0008073,	0.00082151,	0.0008363,	0.00085169,	0.00086771,	0.00088438,	0.00090171,	0.00091974,	0.00093849,	0.00095799,	0.00097828,	0.00099939,	0.00102136,	0.00104422,	0.00106802,	0.00109281,	0.00111863,	0.00114555,	0.0011736,	0.00120286,	0.00123339,	0.00126526,	0.00129855,	0.00133335,	0.00136973,	0.0014078,	0.00144765,	0.00148941,	0.00153319,	0.00157913,	0.00162736,	0.00167805,	0.00173136,	0.00178747,	0.00184659,	0.00190894,	0.00197475,	0.00204428,	0.00211782,	0.00219568,	0.0022782,	0.00236576,	0.00245876,	0.00255765,	0.00266293,	0.00277513,	0.00289485,	0.00302274,	0.0031595,	0.00330589,	0.00346278,	0.00363105,	0.0038117,	0.00400576,	0.00421437,	0.00443867,	0.00467989,	0.00493921,	0.00521784,	0.00551685,	0.00583719,	0.0061795,	0.00654404,	0.00693048,	0.00733774,	0.00776368,	0.00820498,	0.00865674,	0.00911246,	0.00956378,	0.01000078,	0.01041209,	0.01078568,	0.01110962,	0.01137327,	0.01156829,	0.01168972,	0.01173652,	0.01171171,	0.01162192,	0.01147656,	0.01128671,	0.01106399,	0.01081962,	0.01056377,	0.01030519,	0.01005123,	0.00980794,	0.00958046,	0.00937322,	0.00919026,	0.00903527,	0.00891165,	0.00882229,	0.00876958,	0.00875531,	0.00878073,	0.00884682,	0.00895457,	0.00910533,	0.00930112,	0.00954481,	0.0098401,	0.01019152,	0.01060404,	0.01108299,	0.01163346,	0.01226011,	0.01296637,	0.01375411,	0.01462252,	0.01556769,	0.01658159,	0.01765208,	0.01876274,	0.01989395,	0.02102375,	0.02212985,	0.02319089,	0.02418844,	0.02510777,	0.02593856,	0.02667493,	0.02731446,	0.02785738,	0.02830511,	0.02865951,	0.02892203,	0.02909381,	0.02917582,	0.02916944,	0.02907693,	0.02890169,	0.02864832,	0.0283221,	0.02792848,	0.02747226,	0.0269572,	0.02638568,	0.02575919,	0.02507877,	0.02434616,	0.02356438,	0.02273867,	0.02187626,	0.02098658,	0.02008022,	0.01916858,	0.01826276,	0.01737319,	0.01650882,	0.01567713,	0.01488367,	0.01413235,	0.01342524,	0.0127631,	0.01214522,	0.01157,	0.01103495,	0.01053716,	0.01007334,	0.00964028,	0.00923487,	0.0088544,	0.00849661,	0.00815966,	0.00784217,	0.00754298,	0.00726116,	0.00699572,	0.00674562,	0.00650955,	0.00628603,	0.00607333,	0.00586962,	0.00567301,	0.0054818,	0.0052945,	0.00511004,	0.00492776,	0.00474752,	0.00456951,	0.00439429,	0.00422255,	0.00405509,	0.00389265,	0.00373589,	0.00358528,	0.00344117,	0.00330374,	0.00317304,	0.00304899,	0.00293145,	0.00282016,	0.00271489,	0.00261531,	0.00252113,	0.00243202,	0.00234769,	0.00226783,	0.00219215,	0.00212038,	0.00205226,	0.00198756,	0.00192605,	0.00186752,	0.00181178,	0.00175865,	0.00170797,	0.00165957,	0.00161333,	0.00156911,	0.00152679,	0.00148625,	0.0014474,	0.00141013,	0.00137436,	0.00134,	0.00130698,	0.00127522,	0.00124466,	0.00121523,	0.00118689,	0.00115956,	0.00113321,	0.00110778,	0.00108323,	0.00105951,	0.0010366,	0.00101444,	0.00099301,	0.00097228,	0.0009522,	0.00093276,	0.00091393,	0.00089568,	0.00087798,	0.00086082,	0.00084416,	0.000828,	0.00081231,	0.00079706,	0.00078226,	0.00076786,	0.00075387,	0.00074027,	0.00072704,	0.00071416,	0.00070163,	0.00068943,	0.00067755,	0.00066598,	0.00065471,	0.00064372,	0.00063301,	0.00062257,	0.00061239,	0.00060246,	0.00059277,	0.00058332,	0.00057409,	0.00056508,	0.00055628,	0.00054768,	0.00053929,	0.00053109,	0.00052307,	0.00051524,	0.00050758,	0.00050009,	0.00049277,	0.0004856,	0.0004786,	0.00047174,	0.00046503,	0.00045846,	0.00045203,	0.00044574,	0.00043957,	0.00043353,	0.00042762,	0.00042182,	0.00041614,	0.00041058,	0.00040513,	0.00039978,	0.00039454,	0.0003894,	0.00038436,	0.00037942,	0.00037457,	0.00036981,	0.00036515,	0.00036057,	0.00035607,	0.00035166,	0.00034733,	0.00034308,	0.0003389,	0.0003348,	0.00033078,	0.00032682,	0.00032294,	0.00031912,	0.00031537,	0.00031169,	0.00030807,	0.00030451,	0.00030101,	0.00029757,	0.00029419,	0.00029087,	0.0002876,	0.00028439,	0.00028123,	0.00027812,	0.00027506,	0.00027205,	0.00026909,	0.00026618,	0.00026331,	0.00026049,	0.00025771,	0.00025498,	0.00025229,	0.00024964,	0.00024703,	0.00024447,	0.00024194,	0.00023945,	0.000237,	0.00023458,	0.0002322,	0.00022986,	0.00022755,	0.00022528,	0.00022304,	0.00022083,	0.00021865,	0.00021651,	0.00021439,	0.00021231,	0.00021025,	0.00020823,	0.00020623,	0.00020427,	0.00020233,	0.00020041,	0.00019853,	0.00019667,	0.00019483,	0.00019302,	0.00019124,	0.00018947,	0.00018774];

		
		var intense = document.getElementById("intense_1").value;
		//var intense = 900;
		
		var fe2oh = document.getElementById("fe2oh").value;
		var fe3td = document.getElementById("fe3td").value;
		var fe3oh = document.getElementById("fe3oh").value;
		var y0=canvasxmcd.height/2;
		var xmax=canvasxmcd.width;
		
		var y11=[];
		for (var j = 0; j < y1.length; j++) {
			y11.push((y1[j]*intense)); 
		};
				
		
		var sumXMCD=[];
		var x=[];
			
		for (var j = 0; j < y1.length; j++) {
			sumXMCD.push((y1[j]*fe2oh)+(y2[j]*fe3td)+(y3[j]*fe3oh)); //This calculates the sum of each of the three different arrays (y1, y2 and y3) and forms a new array
		};

		for (var i = 0; i < xmax; i++) {
			
			ctx.beginPath();
			ctx.strokeStyle="black";
			ctx.lineTo([i],-1*sumXMCD[i]*intense+y0);
			ctx.lineTo([i+1],-1*sumXMCD[i+1]*intense+y0);
			ctx.lineWidth=3;
			ctx.stroke();
		};
		
		for (var i = 0; i < y1.length; i++) {
			
			ctx.beginPath();
			ctx.strokeStyle="red";
			ctx.lineTo([i],-1*y1[i]*intense*fe2oh+y0);
			ctx.lineTo([i+1],-1*y1[i+1]*intense*fe2oh+y0);
			//ctx.fillRect(i,-1*y2[i]*intense*fe3td+100,3,3);
			ctx.lineWidth=1;
			//ctx.fillStyle="blue";
			ctx.stroke();
		};
		
		for (var i = 0; i < y2.length; i++) {
			
			ctx.beginPath();
			ctx.strokeStyle="blue";
			ctx.lineTo(i,-1*y2[i]*intense*fe3td+y0);
			ctx.lineTo([i+1],-1*y2[i+1]*intense*fe3td+y0);
			//ctx.fillRect(i,-1*y2[i]*intense*fe3td+100,3,3);
			ctx.lineWidth=1;
			//ctx.fillStyle="blue";
			ctx.stroke();
		};
		
		for (var i = 0; i < y3.length; i++) {
			
			ctx.beginPath();
			ctx.strokeStyle="green";
			ctx.lineTo(i,-1*y3[i]*intense*fe3oh+y0);
			ctx.lineTo([i+1],-1*y3[i+1]*intense*fe3oh+y0);
			//ctx.fillRect(i,-1*y3[i]*intense*fe3oh+100,3,3);
			ctx.lineWidth=1;
			//ctx.fillStyle="green";
			ctx.stroke();
		
		}; 
		
		for (var i = 0; i < xmax; i++) {
			
			ctx.beginPath();
			ctx.strokeStyle="black";
			ctx.lineTo(i,-1*sumXMCD[0]*intense+y0); //Straight line at y=0
			ctx.lineTo([i+1],-1*sumXMCD[0]*intense+y0);
			ctx.lineWidth=1;
			ctx.stroke();
		};
		
		ctx.beginPath();
		ctx.lineTo(10,-1*sumXMCD[0]*intense+y0+5);ctx.lineTo(10,-1*sumXMCD[0]+y0-5);
		//ctx.lineTo(20,-1*sumXMCD[0]*intense+y0+5);ctx.lineTo(20,-1*sumXMCD[0]+y0-5);
		ctx.lineWidth=1;
		ctx.stroke();
		
		/*for (var i = 0; i < sumXMCD.length; i++) {
			
			ctx.beginPath();
			ctx.lineTo([i+10],-1*sumXMCD[0]*intense+100);
			ctx.lineTo([i+10],10);
			ctx.lineWidth=1;
			ctx.stroke();
		};*/
};

var pi = 3.14159265359; 

function Loren1(x) {
//Moessbauer function
		
		var canvas = document.getElementById("myCanvas");
			  
		var w = document.getElementById("linewidth_1").value;
		var cens = document.getElementById("censhift_1").value;
		var eps = document.getElementById("qshift_1").value;
		var bhf = document.getElementById("hyperfinefield_1").value;	
		var s=1;
		var ratio1 = document.getElementById("ratio_1").value;
		var r1 =ratio1/s;
		var per1 = document.getElementById("slider1").value;
		
		var I1 = 3;
		var I2 = 2;
		var I3 = 1;
	  
		var x01 = (0 - (bhf/32.95 * 10.657/2) + cens/1 + eps/2); //0-0+CS+QS = CS + QS
		var x02 = (0 - (bhf/32.95 * 6.167/2) + cens/1 - eps/2);  //0-0+CS-QS = CS - QS
		var x03 = (0 - (bhf/32.95 * 1.677/2) + cens/1 - eps/2);  //0-0+CS-QS = CS - QS
		var x04 = (0 + (bhf/32.95 * 1.677/2) + cens/1 - eps/2);  //0+0+CS-QS = CS - QS
		var x05 = (0 + (bhf/32.95 * 6.167/2) + cens/1 - eps/2);  //0+0+CS-QS = CS - QS
		var x06 = (0 + (bhf/32.95 * 10.657/2) + cens/1 + eps/2); //0+0+CS+QS = CS + QS
	  	
	  	var sextet=(per1/100)*(((-(1/pi) * (0.5 * w) * 1/(((x - x01) * (x - x01)) + (w * w * 0.5)))/3*I1) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x02) * (x - x02)) + (w * w * 0.5)))/3*I2) + 
				((-(1/pi) * (0.5 * w) * 1/(((x - x03) * (x - x03)) + (w * w * 0.5)))/3*I3) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x04) * (x - x04)) + (w * w * 0.5)))/3*I3) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x05) * (x - x05)) + (w * w * 0.5)))/3*I2) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x06) * (x - x06)) + (w * w * 0.5)))/3*I1));

	  	var sextet1=r1*sextet;

      
      var myarray=new Array(3)
      
      for (i=0; i <3; i++)
            myarray[i]=new Array(5);

        return  sextet1;
					
		}

function Loren2(x) {
//Moessbauer function
		
		var canvas = document.getElementById("myCanvas"); 
		
		var w = document.getElementById("linewidth_2").value;
		var cens = document.getElementById("censhift_2").value;
		var eps = document.getElementById("qshift_2").value;
		var bhf = document.getElementById("hyperfinefield_2").value;	
		var s=1;
		var ratio2 = document.getElementById("ratio_2").value;
		var r2 =ratio2/s;
		var per1 = document.getElementById("slider1").value;
		
		var I1 = 3;
		var I2 = 2;
		var I3 = 1;
	  
		var x01 = (0 - (bhf/32.95 * 10.657/2) + cens/1 + eps/2); //0-0+CS+QS = CS + QS
		var x02 = (0 - (bhf/32.95 * 6.167/2) + cens/1 - eps/2);  //0-0+CS-QS = CS - QS
		var x03 = (0 - (bhf/32.95 * 1.677/2) + cens/1 - eps/2);  //0-0+CS-QS = CS - QS
		var x04 = (0 + (bhf/32.95 * 1.677/2) + cens/1 - eps/2);  //0+0+CS-QS = CS - QS
		var x05 = (0 + (bhf/32.95 * 6.167/2) + cens/1 - eps/2);  //0+0+CS-QS = CS - QS
		var x06 = (0 + (bhf/32.95 * 10.657/2) + cens/1 + eps/2); //0+0+CS+QS = CS + QS
	  
	  	var sextet=(per1/100)*(((-(1/pi) * (0.5 * w) * 1/(((x - x01) * (x - x01)) + (w * w * 0.5)))/3*I1) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x02) * (x - x02)) + (w * w * 0.5)))/3*I2) + 
				((-(1/pi) * (0.5 * w) * 1/(((x - x03) * (x - x03)) + (w * w * 0.5)))/3*I3) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x04) * (x - x04)) + (w * w * 0.5)))/3*I3) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x05) * (x - x05)) + (w * w * 0.5)))/3*I2) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x06) * (x - x06)) + (w * w * 0.5)))/3*I1));

	  	var sextet2=r2*sextet;
        return  sextet2;
					
		}

function Loren3(x) {
//Moessbauer function
		
		var w = document.getElementById("linewidth_3").value;
		var cens = document.getElementById("censhift_3").value;
		var eps = document.getElementById("qshift_3").value;
		var bhf = document.getElementById("hyperfinefield_3").value;	
		var s=1;
		var ratio3 = document.getElementById("ratio_3").value;
		var r3 =ratio3/s;
		var per1 = document.getElementById("slider1").value;
		
		var I1 = 3;
		var I2 = 2;
		var I3 = 1;
	  
		var x01 = (0 - (bhf/32.95 * 10.657/2) + cens/1 + eps/2); //0-0+CS+QS = CS + QS
		var x02 = (0 - (bhf/32.95 * 6.167/2) + cens/1 - eps/2);  //0-0+CS-QS = CS - QS
		var x03 = (0 - (bhf/32.95 * 1.677/2) + cens/1 - eps/2);  //0-0+CS-QS = CS - QS
		var x04 = (0 + (bhf/32.95 * 1.677/2) + cens/1 - eps/2);  //0+0+CS-QS = CS - QS
		var x05 = (0 + (bhf/32.95 * 6.167/2) + cens/1 - eps/2);  //0+0+CS-QS = CS - QS
		var x06 = (0 + (bhf/32.95 * 10.657/2) + cens/1 + eps/2); //0+0+CS+QS = CS + QS
	  
	  	var sextet=(per1/100)*(((-(1/pi) * (0.5 * w) * 1/(((x - x01) * (x - x01)) + (w * w * 0.5)))/3*I1) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x02) * (x - x02)) + (w * w * 0.5)))/3*I2) + 
				((-(1/pi) * (0.5 * w) * 1/(((x - x03) * (x - x03)) + (w * w * 0.5)))/3*I3) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x04) * (x - x04)) + (w * w * 0.5)))/3*I3) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x05) * (x - x05)) + (w * w * 0.5)))/3*I2) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x06) * (x - x06)) + (w * w * 0.5)))/3*I1));

	  	var sextet3=r3*sextet;
        return  sextet3;
					
		}

function Loren4(x) {
//Moessbauer function
		
		var canvas = document.getElementById("myCanvas"); 	  
		var w = document.getElementById("linewidth_4").value;
		var cens = document.getElementById("censhift_4").value;
		var eps = document.getElementById("qshift_4").value;
		var bhf = document.getElementById("hyperfinefield_4").value;	
		
		var s=1;
		var ratio1 = document.getElementById("ratio_1").value;
		var r1 =ratio1/s;
		var ratio2 = document.getElementById("ratio_2").value;
		var r2 =ratio2/s;
		var ratio3 = document.getElementById("ratio_3").value;
		var r3 =ratio3/s;
		var ratio4 = document.getElementById("ratio_4").value;
		var r4 =ratio4/s;

		var per1 = document.getElementById("slider1").value;
		
		var I1 = 3;
		var I2 = 2;
		var I3 = 1;
	  
		var x01 = (0 - (bhf/32.95 * 10.657/2) + cens/1 + eps/2); //0-0+CS+QS = CS + QS
		var x02 = (0 - (bhf/32.95 * 6.167/2) + cens/1 - eps/2);  //0-0+CS-QS = CS - QS
		var x03 = (0 - (bhf/32.95 * 1.677/2) + cens/1 - eps/2);  //0-0+CS-QS = CS - QS
		var x04 = (0 + (bhf/32.95 * 1.677/2) + cens/1 - eps/2);  //0+0+CS-QS = CS - QS
		var x05 = (0 + (bhf/32.95 * 6.167/2) + cens/1 - eps/2);  //0+0+CS-QS = CS - QS
		var x06 = (0 + (bhf/32.95 * 10.657/2) + cens/1 + eps/2); //0+0+CS+QS = CS + QS
	  
	  	var sextet=(per1/100)*(((-(1/pi) * (0.5 * w) * 1/(((x - x01) * (x - x01)) + (w * w * 0.5)))/3*I1) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x02) * (x - x02)) + (w * w * 0.5)))/3*I2) + 
				((-(1/pi) * (0.5 * w) * 1/(((x - x03) * (x - x03)) + (w * w * 0.5)))/3*I3) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x04) * (x - x04)) + (w * w * 0.5)))/3*I3) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x05) * (x - x05)) + (w * w * 0.5)))/3*I2) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x06) * (x - x06)) + (w * w * 0.5)))/3*I1));

	  	var sextet4=r4*sextet;
        return  sextet4;
					
		}

function Loren_sum(x) {
		
		var canvas = document.getElementById("myCanvas");
		var s=1;
		var ratio1 = document.getElementById("ratio_1").value;
		var r1 =ratio1/s;
		var ratio2 = document.getElementById("ratio_2").value;
		var r2 =ratio2/s;
		var ratio3 = document.getElementById("ratio_3").value;
		var r3 =ratio3/s;
		var ratio4 = document.getElementById("ratio_4").value;
		var r4 =ratio4/s;
		
		var w = document.getElementById("linewidth_1").value;
		var cens = document.getElementById("censhift_1").value;
		var eps = document.getElementById("qshift_1").value;
		var bhf = document.getElementById("hyperfinefield_1").value;
		var per1 = document.getElementById("slider1").value;
		
		var I1 = 3;
		var I2 = 2;
		var I3 = 1;
	  	  
		var x01 = (0 - (bhf/32.95 * 10.657/2) + cens/1 + eps/2); //0-0+CS+QS = CS + QS
		var x02 = (0 - (bhf/32.95 * 6.167/2) + cens/1 - eps/2);  //0-0+CS-QS = CS - QS
		var x03 = (0 - (bhf/32.95 * 1.677/2) + cens/1 - eps/2);  //0-0+CS-QS = CS - QS
		var x04 = (0 + (bhf/32.95 * 1.677/2) + cens/1 - eps/2);  //0+0+CS-QS = CS - QS
		var x05 = (0 + (bhf/32.95 * 6.167/2) + cens/1 - eps/2);  //0+0+CS-QS = CS - QS
		var x06 = (0 + (bhf/32.95 * 10.657/2) + cens/1 + eps/2); //0+0+CS+QS = CS + QS

		var Sextet1=((per1/100)*(((-(1/pi) * (0.5 * w) * 1/(((x - x01) * (x - x01)) + (w * w * 0.5)))/3*I1) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x02) * (x - x02)) + (w * w * 0.5)))/3*I2) + 
				((-(1/pi) * (0.5 * w) * 1/(((x - x03) * (x - x03)) + (w * w * 0.5)))/3*I3) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x04) * (x - x04)) + (w * w * 0.5)))/3*I3) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x05) * (x - x05)) + (w * w * 0.5)))/3*I2) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x06) * (x - x06)) + (w * w * 0.5)))/3*I1)));
		
		var w = document.getElementById("linewidth_2").value;
		var cens = document.getElementById("censhift_2").value;
		var eps = document.getElementById("qshift_2").value;
		var bhf = document.getElementById("hyperfinefield_2").value;
		var per1 = document.getElementById("slider1").value;
		
		var I1 = 3;
		var I2 = 2;
		var I3 = 1;
	  	  
		var x01 = (0 - (bhf/32.95 * 10.657/2) + cens/1 + eps/2); //0-0+CS+QS = CS + QS
		var x02 = (0 - (bhf/32.95 * 6.167/2) + cens/1 - eps/2);  //0-0+CS-QS = CS - QS
		var x03 = (0 - (bhf/32.95 * 1.677/2) + cens/1 - eps/2);  //0-0+CS-QS = CS - QS
		var x04 = (0 + (bhf/32.95 * 1.677/2) + cens/1 - eps/2);  //0+0+CS-QS = CS - QS
		var x05 = (0 + (bhf/32.95 * 6.167/2) + cens/1 - eps/2);  //0+0+CS-QS = CS - QS
		var x06 = (0 + (bhf/32.95 * 10.657/2) + cens/1 + eps/2); //0+0+CS+QS = CS + QS

		var Sextet2=((per1/100)*(((-(1/pi) * (0.5 * w) * 1/(((x - x01) * (x - x01)) + (w * w * 0.5)))/3*I1) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x02) * (x - x02)) + (w * w * 0.5)))/3*I2) + 
				((-(1/pi) * (0.5 * w) * 1/(((x - x03) * (x - x03)) + (w * w * 0.5)))/3*I3) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x04) * (x - x04)) + (w * w * 0.5)))/3*I3) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x05) * (x - x05)) + (w * w * 0.5)))/3*I2) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x06) * (x - x06)) + (w * w * 0.5)))/3*I1)));
	  	
	  	var w = document.getElementById("linewidth_3").value;
		var cens = document.getElementById("censhift_3").value;
		var eps = document.getElementById("qshift_3").value;
		var bhf = document.getElementById("hyperfinefield_3").value;
		var per1 = document.getElementById("slider1").value;
		
		var I1 = 3;
		var I2 = 2;
		var I3 = 1;
	  	  
		var x01 = (0 - (bhf/32.95 * 10.657/2) + cens/1 + eps/2); //0-0+CS+QS = CS + QS
		var x02 = (0 - (bhf/32.95 * 6.167/2) + cens/1 - eps/2);  //0-0+CS-QS = CS - QS
		var x03 = (0 - (bhf/32.95 * 1.677/2) + cens/1 - eps/2);  //0-0+CS-QS = CS - QS
		var x04 = (0 + (bhf/32.95 * 1.677/2) + cens/1 - eps/2);  //0+0+CS-QS = CS - QS
		var x05 = (0 + (bhf/32.95 * 6.167/2) + cens/1 - eps/2);  //0+0+CS-QS = CS - QS
		var x06 = (0 + (bhf/32.95 * 10.657/2) + cens/1 + eps/2); //0+0+CS+QS = CS + QS

		var Sextet3=((per1/100)*(((-(1/pi) * (0.5 * w) * 1/(((x - x01) * (x - x01)) + (w * w * 0.5)))/3*I1) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x02) * (x - x02)) + (w * w * 0.5)))/3*I2) + 
				((-(1/pi) * (0.5 * w) * 1/(((x - x03) * (x - x03)) + (w * w * 0.5)))/3*I3) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x04) * (x - x04)) + (w * w * 0.5)))/3*I3) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x05) * (x - x05)) + (w * w * 0.5)))/3*I2) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x06) * (x - x06)) + (w * w * 0.5)))/3*I1)));

	  var w = document.getElementById("linewidth_4").value;
		var cens = document.getElementById("censhift_4").value;
		var eps = document.getElementById("qshift_4").value;
		var bhf = document.getElementById("hyperfinefield_4").value;
		var per1 = document.getElementById("slider1").value;
		
		var I1 = 3;
		var I2 = 2;
		var I3 = 1;
	  	  
		var x01 = (0 - (bhf/32.95 * 10.657/2) + cens/1 + eps/2); //0-0+CS+QS = CS + QS
		var x02 = (0 - (bhf/32.95 * 6.167/2) + cens/1 - eps/2);  //0-0+CS-QS = CS - QS
		var x03 = (0 - (bhf/32.95 * 1.677/2) + cens/1 - eps/2);  //0-0+CS-QS = CS - QS
		var x04 = (0 + (bhf/32.95 * 1.677/2) + cens/1 - eps/2);  //0+0+CS-QS = CS - QS
		var x05 = (0 + (bhf/32.95 * 6.167/2) + cens/1 - eps/2);  //0+0+CS-QS = CS - QS
		var x06 = (0 + (bhf/32.95 * 10.657/2) + cens/1 + eps/2); //0+0+CS+QS = CS + QS

		var Sextet4=((per1/100)*(((-(1/pi) * (0.5 * w) * 1/(((x - x01) * (x - x01)) + (w * w * 0.5)))/3*I1) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x02) * (x - x02)) + (w * w * 0.5)))/3*I2) + 
				((-(1/pi) * (0.5 * w) * 1/(((x - x03) * (x - x03)) + (w * w * 0.5)))/3*I3) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x04) * (x - x04)) + (w * w * 0.5)))/3*I3) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x05) * (x - x05)) + (w * w * 0.5)))/3*I2) +
				((-(1/pi) * (0.5 * w) * 1/(((x - x06) * (x - x06)) + (w * w * 0.5)))/3*I1)));

	  var SextetSUM=(r1*Sextet1)+(r2*Sextet2)+(r3*Sextet3)+(r4*Sextet4);

    //document.getElementById('datasum_y').value = SextetSUM;

        return  SextetSUM;
					
		}				
	
	function clearall(){
			var ctx=canvas.getContext("2d");
      ctx.clearRect(0,0,canvas.width, canvas.height);
	}	

	function draw_sum() {
			var canvas = document.getElementById("canvas");
			//var xscale = document.getElementById("slider2").value;
			var xscale=33.5; //This value dictates the width of the fit. Needs to be calibrated

      if (null==canvas || !canvas.getContext) return;

			var axes={}, ctx=canvas.getContext("2d");
			axes.x0 = canvas.width;  // x0 pixels from left to x=0
			axes.y0 = .1 + .13*canvas.height; // y0 pixels from top to y=0
			axes.scale = xscale;                 // 40 pixels from x=0 to x=1
			axes.doNegativeX = true;

			ctx.clearRect(0,0,canvas.width, canvas.height);
      
      showAxes(ctx,axes);
			MBplot(ctx,axes,Loren_sum,"black",3);
			MBplot(ctx,axes,Loren1,"red",0.5);
			MBplot(ctx,axes,Loren2,"blue",0.5);
			MBplot(ctx,axes,Loren3,"magenta",0.5);
			MBplot(ctx,axes,Loren4,"green",0.5);

      //Graph(lines)
      newGraph();       
      majoraxes();
	
	}

  /*function linesum(){
      
      var xx, yy, dx=0.1, x0=axes.x0, y0=axes.y0, scale=axes.scale;
      
      var canvas = document.getElementById("canvas");
      var xaxis = 0.9*canvas.width;
      var xaxis0 = 0.1*canvas.width;
      var xmid=0.5*canvas.width;
      var yaxis = 0.9*canvas.height;
      var yaxis0 = 0.1*canvas.height;

      var iMax = Math.round((xaxis-xmid)/dx);
      var iMin = axes.doNegativeX ? Math.round(-xmid/dx) : 0;

        for (var i=iMin;i<=iMax;i++) {
          xx = dx*i; yy = scale*Loren_sum(xx/scale);
          if (i==iMin) ctx.moveTo(xmid+xx,y0-yy);
          else         ctx.lineTo(xmid+xx,y0-yy);
        }


  };*/

	function MBplot (ctx,axes,func,color,thick) {
      var xx, yy, dx=0.1, x0=axes.x0, y0=axes.y0, scale=axes.scale;
			
      var canvas = document.getElementById("canvas");
      //var ctx = canvas.getContext("2d");

      var xaxis = 0.9*canvas.width;
      var xaxis0 = 0.1*canvas.width;
      var xmid=0.5*canvas.width;
      var yaxis = 0.9*canvas.height;
      var yaxis0 = 0.1*canvas.height;

      /*var xrangemin = document.getElementById("rangemin").value;
      var xrangemax = document.getElementById("rangemax").value;
      var xxrange=xrangemax-xrangemin;*/

      var iMax = Math.round((xaxis-xmid)/dx);
      var iMin = axes.doNegativeX ? Math.round(-xmid/dx) : 0;
 
      ctx.beginPath();      
      ctx.lineWidth = thick;
      ctx.strokeStyle = color;

        for (var i=iMin;i<=iMax;i++) {
          xx = dx*i; yy = scale*func(xx/scale);
          if (i==iMin) ctx.moveTo(xmid+xx,y0-yy);
          else         ctx.lineTo(xmid+xx,y0-yy);
        }
      ctx.stroke();


      //To determine the chi^2 it is essential that each value of x is broken down into an array value
      var ysum=[];
        for (var i=iMin;i<=iMax;i++) {
          xx = dx*i; yy = scale*func(xx/scale);
          ysum.push(Loren_sum(i)); 
      };
      //document.getElementById('datasum_y2').value = ysum;

	}

	function showAxes(ctx,axes) {
			/*var x0=axes.x0, w=0.1*ctx.canvas.width;
			var y0=axes.y0, h=ctx.canvas.height;
			var xscale = document.getElementById("slider2").value;
			var wx=xscale*2;
			var wxx=w*10;
			var xmin = axes.doNegativeX ? 0 : x0;*/
 			
			//ctx.clearRect(0,0,canvas.width, canvas.height);
			
			/*ctx.beginPath();
			ctx.strokeStyle = "black"; 
			ctx.moveTo(xmin,y0); ctx.lineTo(wxx,y0);  // X axis
				*/
			
			//ctx.moveTo(xmin+50,50);    ctx.lineTo(xmin+50,500);  // Y axis
			/*ctx.moveTo(x0,50);    ctx.lineTo(x0,60);  // Y axis
			ctx.moveTo(x0+wx,50);    ctx.lineTo(x0+wx,60);  // Y axis
			ctx.moveTo(x0+wx*2,50);    ctx.lineTo(x0+wx*2,60);  // Y axis
			ctx.moveTo(x0+wx*3,50);    ctx.lineTo(x0+wx*3,60);  // Y axis
			ctx.moveTo(x0+wx*4,50);    ctx.lineTo(x0+wx*4,60);  // Y axis
			ctx.moveTo(x0+wx*5,50);    ctx.lineTo(x0+wx*5,60);  // Y axis
		
			ctx.moveTo(x0-wx,50);    ctx.lineTo(x0-wx,60);  // Y axis
			ctx.moveTo(x0-wx*2,50);    ctx.lineTo(x0-wx*2,60);  // Y axis
			ctx.moveTo(x0-wx*3,50);    ctx.lineTo(x0-wx*3,60);  // Y axis
			ctx.moveTo(x0-wx*4,50);    ctx.lineTo(x0-wx*4,60);  // Y axis
			ctx.moveTo(x0-wx*5,50);    ctx.lineTo(x0-wx*5,60);  // Y axis
			
			ctx.font="12pt Calibri Light";
			ctx.fillText("Velocity [mm/s]",x0-50,20);
			ctx.fillText("0",x0-4,40);
			
			ctx.fillText("2",x0+wx,40);
			ctx.fillText("4",x0+wx*2,40);
			ctx.fillText("6",x0+wx*3,40);
			ctx.fillText("8",x0+wx*4,40);
			ctx.fillText("10",x0+wx*5,40);
			
			ctx.fillText("-2",x0-wx,40);
			ctx.fillText("-4",x0-wx*2,40);
			ctx.fillText("-6",x0-wx*3,40);
			ctx.fillText("-8",x0-wx*4,40);
			ctx.fillText("-10",x0-wx*5,40);*/
			
			ctx.stroke();

	}
		
		
/*For each individual parameter, we need an individual code*************************************/

	function draw_sumCS() {
			var canvas = document.getElementById("canvas");
			var xscale = document.getElementById("slider2").value;
			if (null==canvas || !canvas.getContext) return;

			var axes={}, ctx=canvas.getContext("2d");
			axes.x0 = 2 + 0.5*canvas.width;  // x0 pixels from left to x=0
			axes.y0 = .1 + .2*canvas.height; // y0 pixels from top to y=0
			axes.scale = xscale;                 // 40 pixels from x=0 to x=1
			axes.doNegativeX = true;

			
			
			ctx.clearRect(0,0,canvas.width, canvas.height);
			showAxes(ctx,axes);
      MBplot(ctx,axes,Loren1,"blue",1);
			
	}

	function draw_sumQS() {
			var canvas = document.getElementById("canvasQS");
			var xscale = document.getElementById("slider2").value;
			if (null==canvas || !canvas.getContext) return;

			var axes={}, ctx=canvas.getContext("2d");
			axes.x0 = 2 + 0.5*canvas.width;  // x0 pixels from left to x=0
			axes.y0 = .1 + .2*canvas.height; // y0 pixels from top to y=0
			axes.scale = xscale;                 // 40 pixels from x=0 to x=1
			axes.doNegativeX = true;

			ctx.clearRect(0,0,canvas.width, canvas.height);
      showAxes(ctx,axes);
			MBplot(ctx,axes,Loren2,"red",1);
			
	}

		function draw_sumBHF() {
			var canvas = document.getElementById("canvasBHF");
			var xscale = document.getElementById("slider2").value;
			
			if (null==canvas || !canvas.getContext) return;

			var axes={}, ctx=canvas.getContext("2d");
			axes.x0 = 2 + 0.5*canvas.width;  // x0 pixels from left to x=0
			axes.y0 = .1 + .2*canvas.height; // y0 pixels from top to y=0
			axes.scale = xscale;                 // 40 pixels from x=0 to x=1
			axes.doNegativeX = true;

			ctx.clearRect(0,0,canvas.width, canvas.height);
      showAxes(ctx,axes);
			MBplot(ctx,axes,Loren3,"green",1);
			
	}


/*Load data***********************/


/*function newDoc(files) {
    //window.location.assign("https://www.mtholyoke.edu/courses/mdyar/database/oxides/jb499/12041805.txt")
    //window.location.assign("Dataset/15012902.txt")
  var str ="test";
  var url = ("/dataset/11012401.txt");

  if (window.FileReader) {
    // FileReader are supported.
    getAsText(url);
  } else {
    alert('FileReader are not supported in this browser.');
  }

}*/

function loadXMLDoc() {
  var xmlhttp = new XMLHttpRequest();
  xmlhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      datalist(this);
    }
  };
  xmlhttp.open("GET", "mineralspectra.xml", true);
  xmlhttp.send();
}

function datalist(xml) {
  var x1, x2, x3, x4, x5, i, xmlDoc, txt;
  xmlDoc = xml.responseXML;
  txt = "<select id='sample' size='10' style='width:170px'>";
  x1 = xmlDoc.getElementsByTagName("folder");
  x2 = xmlDoc.getElementsByTagName("mineral");
  x3 = xmlDoc.getElementsByTagName("filetype");
  x4 = xmlDoc.getElementsByTagName("samplename");
  x5 = xmlDoc.getElementsByTagName("temp");

  for (i = 0; i< x2.length; i++) {
    //txt += "<option value=dataset/" + x1[i].childNodes[0].nodeValue + "/" + x4[i].childNodes[0].nodeValue + "." + x3[i].childNodes[0].nodeValue + " onclick=samplespectra()>" "value=dataset/" + x1[i].childNodes[0].nodeValue + "/" + x4[i].childNodes[0].nodeValue + "." + x3[i].childNodes[0].nodeValue + " onclick=samplespectra()" + "</option>";
    txt += "<option value=dataset/" + x1[i].childNodes[0].nodeValue + "/" + x4[i].childNodes[0].nodeValue + "." + x3[i].childNodes[0].nodeValue + " onclick='samplespectra()'>" + x2[i].childNodes[0].nodeValue + " - " + x5[i].childNodes[0].nodeValue + "K" + "</option>";

  }
  txt +="</select>";
  document.getElementById("xmlsamplelist").innerHTML = txt;
}


function handleFiles(files) {
  // Check for the various File API support.
  if (window.FileReader) {
    // FileReader are supported.
    getAsText(files[0]);
  } else {
    alert('FileReader are not supported in this browser.');
  }
}

function getAsText(fileToRead) {
  var reader = new FileReader();
  // Handle errors load
  reader.onload = loadHandler;
  reader.onerror = errorHandler;
  // Read file into memory as UTF-8      
  reader.readAsText(fileToRead);
  //reader.readAsDataURL(fileToRead);
   
}

function loadHandler(event) {
  var csv = event.target.result;
  document.getElementById('dataoutput').value = csv;

  processData(csv);             
}

function samplespectra(){
  var sampleSelect = $('#cssmenu');
  var csv = $('#dataoutput');

  sampleSelect.bind('change', function(e) {
    $.get(e.target.value, function(data) {
      csv.text(data);
      $('#outputtxt3').attr('value', csv.text());
      processlistData();
    });
  });
};

function processlistData() {
    //alert("hello")

    var csv = document.getElementById("outputtxt3").value;

    var allTextLines = csv.split(/\r\n|\n/);
    var startline = document.getElementById("startline").value;

    var deliminat1 = document.getElementById("delChoice1");
    var deliminat2 = document.getElementById("delChoice2");
    var deliminat3 = document.getElementById("delChoice3");
    var deliminat4 = document.getElementById("delChoice4");

    allTextLines.splice(0,startline);
    allTextLines.pop();
        allTextLines.pop();
            allTextLines.pop();
                allTextLines.pop();
                    allTextLines.pop();
                        allTextLines.pop();
    var lines = [];

    if(deliminat1.checked){
      while (allTextLines.length) {
        lines.push(allTextLines.shift().split('\t')); //For text separated by tab
      }
    }

    if(deliminat2.checked){
      while (allTextLines.length) {
        lines.push(allTextLines.shift().split(',')); //For text separated by comma
      }
    }

    if(deliminat3.checked){
      while (allTextLines.length) {
        lines.push(allTextLines.shift().split(' ')); //For text separated by space
      }
    }

    else if(deliminat4.checked){
      while (allTextLines.length) {
        lines.push(allTextLines.shift().split(' ')); //For text separated by space
      }
    }

    /*while (allTextLines.length) {
        //lines.push(allTextLines.shift().split(' ')); //For text separated by space
        //lines.push(allTextLines.shift().split(',')); //For text separated by comma
        //lines.push(allTextLines.shift().split(';')); //For text separated by semi colon
        lines.push(allTextLines.shift().split('\t')); //For text separated by tab

    }*/
  console.log(lines);
  //drawOutput(lines);
  MBdata(lines);
  //axes();
}


function processData(csv) {
    
    var allTextLines = csv.split(/\r\n|\n/);
    var startline = document.getElementById("startline").value;

    var deliminat1 = document.getElementById("delChoice1");
    var deliminat2 = document.getElementById("delChoice2");
    var deliminat3 = document.getElementById("delChoice3");
    var deliminat4 = document.getElementById("delChoice4");

    allTextLines.splice(0,startline);
    allTextLines.pop();
        allTextLines.pop();
            allTextLines.pop();
                allTextLines.pop();
                    allTextLines.pop();
                        allTextLines.pop();
    var lines = [];

    if(deliminat1.checked){
      while (allTextLines.length) {
        lines.push(allTextLines.shift().split('\t')); //For text separated by tab
      }
    }

    if(deliminat2.checked){
      while (allTextLines.length) {
        lines.push(allTextLines.shift().split(',')); //For text separated by comma
      }
    }

    if(deliminat3.checked){
      while (allTextLines.length) {
        lines.push(allTextLines.shift().split(' ')); //For text separated by space
      }
    }

    else if(deliminat4.checked){
      while (allTextLines.length) {
        lines.push(allTextLines.shift().split(' ')); //For text separated by space
      }
    }

    /*while (allTextLines.length) {
        //lines.push(allTextLines.shift().split(' ')); //For text separated by space
        //lines.push(allTextLines.shift().split(',')); //For text separated by comma
        //lines.push(allTextLines.shift().split(';')); //For text separated by semi colon
        lines.push(allTextLines.shift().split('\t')); //For text separated by tab

    }*/
  console.log(lines);
  //drawOutput(lines);
  MBdata(lines);

  //axes();
}

function errorHandler(evt) {
  if(evt.target.error.name == "NotReadableError") {
    alert("Cannot read file !");
  }
}


function majoraxes() {
//Draws the box for the axes
    
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");
    
    var xaxis = 0.9*canvas.width;
    var xaxis0 = 0.1*canvas.width;
    var yaxis = 0.9*canvas.height;
    var yaxis0 = 0.1*canvas.height;

    
    ctx.beginPath();
    ctx.setLineDash([5,5]);
    ctx.lineWidth=0.1;
    ctx.moveTo(canvas.width/2,yaxis0);
    ctx.lineTo(canvas.width/2,yaxis); //draws the line
    ctx.stroke();

    ctx.beginPath();
    ctx.setLineDash([0,0]);
    ctx.lineWidth="2";
    ctx.fillStyle="white";
    //For setting the white rectangles, (x,y,width,height)
    ctx.fillRect(0,0,xaxis0,2*yaxis0); 
    ctx.fillRect(xaxis,0,xaxis0*0.995,2*yaxis0); 
    ctx.fillStyle="black";

    ctx.stroke(); 

    ctx.beginPath();
    ctx.moveTo(xaxis0,yaxis0);
    ctx.lineTo(xaxis0,yaxis); //draws the line
    ctx.moveTo(xaxis,yaxis0);
    ctx.lineTo(xaxis,yaxis); //draws the line
    ctx.moveTo(xaxis0,yaxis);
    ctx.lineTo(xaxis,yaxis); //draws the line
    ctx.moveTo(xaxis0,yaxis0);
    ctx.lineTo(xaxis,yaxis0); //draws the line
    ctx.moveTo(xaxis0,yaxis0);
    ctx.lineTo(xaxis0,yaxis); //draws the line
    ctx.moveTo(xaxis,yaxis0);
    ctx.lineTo(xaxis,yaxis); //draws the line
    ctx.moveTo(xaxis0,yaxis);
    ctx.lineTo(xaxis,yaxis); //draws the line
    ctx.moveTo(xaxis0,yaxis0);
    ctx.lineTo(xaxis,yaxis0); //draws the line
    
    ctx.lineWidth=1;
    var xminlabel=-12
    var xmaxlabel=12
    var xrange=canvas.width*0.8/24*2;
    var yrange=canvas.height*0.9;

    //Declare where the min value should sit:
    //ctx.fillText(xminlabel,xaxis0,yrange+20); 
    //Draw the line:
    //ctx.moveTo(xaxis0,yrange+10); ctx.lineTo(xaxis0,yrange); 
    //Declare where the max value should sit:
    //ctx.fillText(xmaxlabel,xaxis,yrange+20); 
    //Draw the line:
    //ctx.moveTo(xaxis,yrange+10); ctx.lineTo(xaxis,yrange); 
    //X axis-label:  

    var xrangemin = document.getElementById("rangemin").value;
    var xrangemax = document.getElementById("rangemax").value;
    var xxrange=xrangemax-xrangemin;
    var xtab=canvas.width*0.8/xxrange*2;

    //Declare the labels and positions of the tick marks along the x-axis
        ctx.moveTo(xaxis0,yrange+10); ctx.lineTo(xaxis0,yrange); 
    ctx.fillText(xrangemin,xaxis0,yrange+20);

        ctx.moveTo(xaxis0+xtab,yrange+10); ctx.lineTo(xaxis0+xtab,yrange); 
    ctx.fillText(xrangemin/6*5,xaxis0+xrange,yrange+20);

        ctx.moveTo(xaxis0+xtab*2,yrange+10); ctx.lineTo(xaxis0+xtab*2,yrange); 
    ctx.fillText(xrangemin/6*4,xaxis0+xrange*2,yrange+20);

        ctx.moveTo(xaxis0+xtab*3,yrange+10); ctx.lineTo(xaxis0+xtab*3,yrange); 
    ctx.fillText(xrangemin/6*3,xaxis0+xrange*3,yrange+20);

        ctx.moveTo(xaxis0+xtab*4,yrange+10); ctx.lineTo(xaxis0+xtab*4,yrange); 
    ctx.fillText(xrangemin/6*2,xaxis0+xrange*4,yrange+20);

        ctx.moveTo(xaxis0+xtab*5,yrange+10); ctx.lineTo(xaxis0+xtab*5,yrange); 
    ctx.fillText(xrangemin/6,xaxis0+xrange*5,yrange+20);

        ctx.moveTo(xaxis0+xtab*6,yrange+10); ctx.lineTo(xaxis0+xtab*6,yrange); 
    ctx.fillText("0",xaxis0+xrange*6,yrange+20);

        ctx.moveTo(xaxis0+xtab*7,yrange+10); ctx.lineTo(xaxis0+xtab*7,yrange);     
    ctx.fillText(xrangemax/6,xaxis0+xrange*7,yrange+20);

        ctx.moveTo(xaxis0+xtab*8,yrange+10); ctx.lineTo(xaxis0+xtab*8,yrange); 
    ctx.fillText(xrangemax/6*2,xaxis0+xrange*8,yrange+20);

        ctx.moveTo(xaxis0+xtab*9,yrange+10); ctx.lineTo(xaxis0+xtab*9,yrange); 
    ctx.fillText(xrangemax/6*3,xaxis0+xrange*9,yrange+20);

        ctx.moveTo(xaxis0+xtab*10,yrange+10); ctx.lineTo(xaxis0+xtab*10,yrange); 
    ctx.fillText(xrangemax/6*4,xaxis0+xrange*10,yrange+20);

        ctx.moveTo(xaxis0+xtab*11,yrange+10); ctx.lineTo(xaxis0+xtab*11,yrange); 
    ctx.fillText(xrangemax/6*5,xaxis0+xrange*11,yrange+20);
    
        ctx.moveTo(xaxis0+xtab*12,yrange+10); ctx.lineTo(xaxis0+xtab*12,yrange); 
    ctx.fillText(xrangemax,xaxis0+xrange*12,yrange+20);
     
    //ctx.fillText("Velocity (mm/s)",canvas.width/2,yrange+20); 

    ctx.globalAlpha=1; //Sets opacity, default = 1
    ctx.lineWidth=1;
    ctx.strokeStyle="black";
    ctx.stroke(); //draws the line
      return  
          
};


function MBdata(lines){

  document.getElementById("output").innerHTML = "";
  var canvas = document.getElementById("canvas");
  var ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width, canvas.height);
  //draw_sum();

  var xaxis = 0.9*canvas.width;
  var xaxis0 = 0.1*canvas.width;
  var yaxis = 0.7*canvas.height;
  var yaxis0 = 0.1*canvas.height;

  var listx = ""; //Starts string
  var listy = ""; //Starts string
  var names = lines;

  //Radio buttons
  var deliminat1 = document.getElementById("delChoice1");
  var deliminat2 = document.getElementById("delChoice2");
  var deliminat3 = document.getElementById("delChoice3");
  var deliminat4 = document.getElementById("delChoice4");


  if(deliminat1.checked){
    for(i=0;i<names.length;i++){
      listx = listx.concat(names[i][0] + ',');
         // listy = listy.replace("undefined", "");
      listy = listy.concat(names[i][1] + ','); //Combines the values of the second column (if 1) into a string
          listy = listy.replace("undefined", "");  
    };
  }

  else if(deliminat2.checked){
    for(i=0;i<names.length;i++){
      listx = listx.concat(names[i][0] + ',');
         // listy = listy.replace("undefined", "");
      listy = listy.concat(names[i][1] + ','); //Combines the values of the second column (if 1) into a string
          listy = listy.replace("undefined", "");  
    };
  }
  
  else if(deliminat3.checked){
    for(i=0;i<names.length;i++){
      listx = listx.concat(names[i][0] + ',');
         // listy = listy.replace("undefined", "");
      listy = listy.concat(names[i][1] + ','); //Combines the values of the second column (if 1) into a string
          listy = listy.replace("undefined", "");  
    };
  }

  else if(deliminat4.checked){
    for(i=0;i<names.length;i++){
      listx = listx.concat(names[i][2] + names[i][3] + names[i][4] + names[i][5] + ','); //Combines the values of the first (if 0) column into a string
      //listy = listy.concat(names[i][7] + ','); //Combines the values of the second column (if 1) into a string
      listy = listy.concat(names[i][7] + names[i][8] + names[i][9] + ','); //Combines the values of the second column (if 1) into a string
      listy = listy.replace("undefined", "");
    }
  }
  
  document.getElementById('outputtxt1').value = listx;
  document.getElementById('outputtxt2').value = listy;

  var xminlabel=-12
  var xmaxlabel=12
  var xrange=canvas.width*0.8/24*2;
  var yrange=canvas.height*0.9;

  var xrangemin = document.getElementById("rangemin").value;
  var xrangemax = document.getElementById("rangemax").value;
  var xxrange=xrangemax-xrangemin;
  var xtab=canvas.width*0.8/xxrange*2;
  
 //Declare the labels and positions of the tick marks along the x-axis
        ctx.moveTo(xaxis0,yrange+10); ctx.lineTo(xaxis0,yrange); 
    ctx.fillText(xrangemin,xaxis0,yrange+20);

        ctx.moveTo(xaxis0+xtab,yrange+10); ctx.lineTo(xaxis0+xtab,yrange); 
    ctx.fillText(xrangemin/6*5,xaxis0+xrange,yrange+20);

        ctx.moveTo(xaxis0+xtab*2,yrange+10); ctx.lineTo(xaxis0+xtab*2,yrange); 
    ctx.fillText(xrangemin/6*4,xaxis0+xrange*2,yrange+20);

        ctx.moveTo(xaxis0+xtab*3,yrange+10); ctx.lineTo(xaxis0+xtab*3,yrange); 
    ctx.fillText(xrangemin/6*3,xaxis0+xrange*3,yrange+20);

        ctx.moveTo(xaxis0+xtab*4,yrange+10); ctx.lineTo(xaxis0+xtab*4,yrange); 
    ctx.fillText(xrangemin/6*2,xaxis0+xrange*4,yrange+20);

        ctx.moveTo(xaxis0+xtab*5,yrange+10); ctx.lineTo(xaxis0+xtab*5,yrange); 
    ctx.fillText(xrangemin/6,xaxis0+xrange*5,yrange+20);

        ctx.moveTo(xaxis0+xtab*6,yrange+10); ctx.lineTo(xaxis0+xtab*6,yrange); 
    ctx.fillText("0",xaxis0+xrange*6,yrange+20);

        ctx.moveTo(xaxis0+xtab*7,yrange+10); ctx.lineTo(xaxis0+xtab*7,yrange);     
    ctx.fillText(xrangemax/6,xaxis0+xrange*7,yrange+20);

        ctx.moveTo(xaxis0+xtab*8,yrange+10); ctx.lineTo(xaxis0+xtab*8,yrange); 
    ctx.fillText(xrangemax/6*2,xaxis0+xrange*8,yrange+20);

        ctx.moveTo(xaxis0+xtab*9,yrange+10); ctx.lineTo(xaxis0+xtab*9,yrange); 
    ctx.fillText(xrangemax/6*3,xaxis0+xrange*9,yrange+20);

        ctx.moveTo(xaxis0+xtab*10,yrange+10); ctx.lineTo(xaxis0+xtab*10,yrange); 
    ctx.fillText(xrangemax/6*4,xaxis0+xrange*10,yrange+20);

        ctx.moveTo(xaxis0+xtab*11,yrange+10); ctx.lineTo(xaxis0+xtab*11,yrange); 
    ctx.fillText(xrangemax/6*5,xaxis0+xrange*11,yrange+20);
    
        ctx.moveTo(xaxis0+xtab*12,yrange+10); ctx.lineTo(xaxis0+xtab*12,yrange); 
    ctx.fillText(xrangemax,xaxis0+xrange*12,yrange+20);
     

  var strx = listx.replace(/,\s*$/, " "); //Removes the last comma from the string
  var arrayx = strx.split(",");
  var x0=arrayx;

  var stry = listy.replace(/,\s*$/, "");  //Removes the last comma from the string
  var arrayy = stry.split(",");
  var y0=arrayy;
    var ylength=y0.length;

  var maxy=Math.max.apply(null, y0);
  var miny=Math.min.apply(null, y0);
    //var maxy=0;
    //var miny=-1;
  var yrange=canvas.height*0.9;
  var y = y0.map(function(y0) { return -(((y0-miny)/(maxy-miny)-1)*yaxis-yaxis0); }); //Multiplies the y-range so that it fits into a defined range 


  var ypercent = Math.round(100-(miny)/(maxy)*100); //Converts intensity of y values into a percentage
  var yzero = (y[0]+y[y.length])/2; // Determines the average point between the first and last measurements
  var ysum = y0.reduce(function(a,b) {
      return ((+a)+(+b)); //Calculates the sum of all values of y
  });

  var yavg = y0.reduce(function(a,b) {
      return ((+a)+(+b))/ylength; //Calculates the average of all values of y
  });
  


  var yavg = Math.round( yavg * 100 ) / 100; //Rounds number to 1 decimal point
  //var ymaxlabel=Math.round(((document.getElementById('output').innerHTML=maxy))*10)/10


  /*ctx.fillText("0",xaxis0/2,yrange); //Declares where the zero% value should sit
  ctx.moveTo(xaxis0-10,yrange); ctx.lineTo(xaxis0,yrange); //draws the tick mark

  ctx.fillText(ymaxlabel/2,xaxis0/2,(yrange+yaxis0)/2); //Declares where the zero% value should sit
  ctx.moveTo(xaxis0-10,(yrange+yaxis0)/2); ctx.lineTo(xaxis0,(yrange+yaxis0)/2); //draws the tick mark
  
  ctx.fillText(ymaxlabel,xaxis0/2,yaxis0); //Declares where the 100% value should sit
  ctx.moveTo(xaxis0-10,yaxis0); ctx.lineTo(xaxis0,yaxis0); //draws the tick mark*/

  ctx.lineWidth=1;
  ctx.strokeStyle="black";
  ctx.stroke(); //draws the line


  //Here it would be possible to specify the range in which the data is published but would need to adjust the X00 value as well
  var xrangemin = document.getElementById("rangemin").value;
  var xrangemax = document.getElementById("rangemax").value;
  var x00=xrangemin;
  var xmin=xrangemin;
  var xmax=xrangemax;

    //var x00=-12;
    //var xmin=-12;
    //var xmax=12;

    //var xmin=Math.min.apply(null, x0);
    //var xmax=Math.max.apply(null, x0);

  //Determine the multiplicaiton factor for each datapoint:
  var xrange = ((canvas.width)/(xmax-xmin));
  
  //Multiply each datapoint so that it fits within the canvas window:
  x = x0.map(function(x0) { 
    //return x0*10; });
    //return x0*xrange+canvas.width/2; });
  return x0*xrange*0.8-x00*xrange*0.8; });
    //return x0*xrange*0.8-x00*xrange*0.8; });

  var xminlabel=Math.round(((document.getElementById('output').innerHTML=xmin)))
  var xmaxlabel=Math.round(((document.getElementById('output').innerHTML=xmax)))


  //Radio buttons for displaying data
  var marker1 = document.getElementById("marker1");
  var marker2 = document.getElementById("marker2");

  if(marker1.checked){
    for (var i = 0; i < x.length; i++) {
      ctx.fillRect(x[i]-1.5+xaxis0,y[i]+1.5,3,3); 
      //draws the pixels as individual rectangles. The "-1.5" moves the centre of each pixel to the middle of the line. The -xaxis0 shifts the x-axis to the edge of the inner window
    };
  }

  else if(marker2.checked){
    for (var i = 0; i < x.length; i++) {
      //ctx.lineTo(x[i]-1.5+xaxis0,y[i]+1.5,3,3); 
      //draws the pixels as individual rectangles. The "-1.5" moves the centre of each pixel to the middle of the line. The -xaxis0 shifts the x-axis to the edge of the inner window
      ctx.beginPath();
      ctx.moveTo(x[i]-1.5+xaxis0,y[i]+1.5);
      ctx.lineTo(x[i+1]-1.5+xaxis0,y[i+1]+1.5);
      ctx.stroke();
    };
  }


  
  var ysum=[];
  var xdiv=0;
  
  var x1=x[1];
  var x2=x[2];
  var x3=x[500];
  var x4=x[501];
  var bkgd=x1+x2+x3+x4;
  //alert(bkdg)

  var nuxmin=xmin*256/12;
  var nuxmax=xmax*256/12;

  for (var i = nuxmin; i <= nuxmax; i++) {
      xdiv = i/22;
      ysum.push(Loren_sum(xdiv)); 
  };
  
  //Add all values within the array
    //var Sx = 0;
  var Syy = 0;
  var yvar = 0; //Variance

  for(var i=0; i< x.length; i++) {
      //Sx += ysum[i]*1;
      yvar += (y[i]-yavg)*(y[i]-yavg);
      Syy += (y[i]-ysum[i])*(y[i]-ysum[i])/(y[i]);
  }

  yvar=yvar*1/(x.length-1);

  document.getElementById('chisq').value = Math.round(Syy*10)/10;

  //document.getElementById('datasum_y').value = ysum;
  //document.getElementById('datasum_y2').value = Syy;

  //Write information about the plot into the webpage
  document.getElementById('output').innerHTML = "Error: " + Math.round(Sx*10)/10 + "<br>" + " Max. y: " + Math.round(maxy*10)/10 + "<br>" + "Max. x: " + Math.round(xmax*10)/10 + "<br>" + "Min. x: " + Math.round(xmin*10)/10 + "<br>" + " Min. y: " + miny + "<br>" + " Sum: " + Math.round(ysum*10)/10 + "<br>" + " Average:" + yavg + "<br>" + " Variance:" + yvar;

  //redraw all axes
  majoraxes();
};


function newGraph(){
   
  var listx = document.getElementById("outputtxt1").value;
  var listy = document.getElementById("outputtxt2").value;
  var canvas = document.getElementById("canvas");
  var ctx = canvas.getContext("2d");
  
  var xaxis = 0.9*canvas.width;
  var xaxis0 = 0.1*canvas.width;
  var yaxis = 0.7*canvas.height;
  var yaxis0 = 0.1*canvas.height;


  //Remove the last comma from the string
  var strx = listx.replace(/,\s*$/, " "); 
  //Divide into array deliminated by comma
  var arrayx = strx.split(",");
  var x0=arrayx;  

  //Remove the last comma from the string  
  var stry = listy.replace(/,\s*$/, ""); 
  
  //Divide into array deliminated by comma
  var arrayy = stry.split(",");
  var y0=arrayy;
  var ylength=y0.length;
  
  var maxy=Math.max.apply(null, y0);
  var miny=Math.min.apply(null, y0);

  var yrange=canvas.height*0.9;

  //Multiplies the y-range so that it fits into the defined canvas 
  var y = y0.map(function(y0) { return -(((y0-miny)/(maxy-miny)-1)*yaxis-yaxis0); }); 

  //Converts intensity of y values into a percentage
  var ypercent = Math.round(100-(miny)/(maxy)*100);
  
  // Determines the average point between the first and last measurements 
  var yzero = (y[0]+y[y.length])/2;

  //Calculates the sum of all values of y 
  var ysum = y0.reduce(function(a,b) {
      return ((+a)+(+b)); 
  });

  //Calculates the average of all values of y
  var yavg = y0.reduce(function(a,b) {
      return ((+a)+(+b))/ylength; 
  });
  
  var yavg = Math.round( yavg * 100 ) / 100; //Rounds number to 1 decimal point
  //var ymaxlabel=Math.round(((document.getElementById('output').innerHTML=maxy))*10)/10

  ctx.lineWidth=1;
  ctx.strokeStyle="black";
  ctx.stroke(); //draws the line
  
  var xrangemin = document.getElementById("rangemin").value;
  var xrangemax = document.getElementById("rangemax").value;
  var x00=xrangemin;
  var xmin=xrangemin;
  var xmax=xrangemax;

    //var x00=-12;
    //var xmin=-12;
    //var xmax=12;
    //var xmin=Math.min.apply(null, x0);
    //var xmax=Math.max.apply(null, x0);

  //Determine the multiplicaiton factor for each datapoint:
  var xrange = ((canvas.width)/(xmax-xmin));
  //Multiply each datapoint so that it fits within the canvas window:
  x = x0.map(function(x0) { 
    //return x0*10; });
    //return x0*xrange+canvas.width/2; });
  return x0*xrange*0.8-x00*xrange*0.8; });
    //return x0*xrange*0.8-x00*xrange*0.8; });

  var xminlabel=Math.round(((document.getElementById('output').innerHTML=xmin)))
  var xmaxlabel=Math.round(((document.getElementById('output').innerHTML=xmax)))

  //Declare where the min value should sit:
  ctx.fillText(xminlabel,xaxis0,yrange+20); 
  //Draw the line:
  ctx.moveTo(xaxis0,yrange+10); ctx.lineTo(xaxis0,yrange); 
  //Declare where the max value should sit:
  ctx.fillText(xmaxlabel,xaxis,yrange+20); 
  //Draw the line:
  ctx.moveTo(xaxis,yrange+10); ctx.lineTo(xaxis,yrange); 
  //X axis-label:  
  //ctx.fillText("Velocity (mm/s)",canvas.width/2,yrange+20); 


  //Radio buttons for displaying data
  var marker1 = document.getElementById("marker1");
  var marker2 = document.getElementById("marker2");

  if(marker1.checked){
    for (var i = 0; i < x.length; i++) {
      ctx.fillRect(x[i]-1.5+xaxis0,y[i]+1.5,3,3); 
      //draws the pixels as individual rectangles. The "-1.5" moves the centre of each pixel to the middle of the line. The -xaxis0 shifts the x-axis to the edge of the inner window
    };
  }

  else if(marker2.checked){
    for (var i = 0; i < x.length; i++) {
      //ctx.lineTo(x[i]-1.5+xaxis0,y[i]+1.5,3,3); 
      //draws the pixels as individual rectangles. The "-1.5" moves the centre of each pixel to the middle of the line. The -xaxis0 shifts the x-axis to the edge of the inner window
      ctx.beginPath();
      ctx.moveTo(x[i]-1.5+xaxis0,y[i]+1.5);
      ctx.lineTo(x[i+1]-1.5+xaxis0,y[i+1]+1.5);
      //ctx.stroke();
    };
  }



  var yfitsum=[];
  var ysite1=[];
  var ysite2=[];  
  var ysite3=[];
  var ysite4=[];

  var xdiv=0;

  var nuxmin=xmin*256/12;
  var nuxmax=xmax*256/12;
  
  for (var i = nuxmin; i <= nuxmax; i++) {
      xdiv = i/22;
      yfitsum.push(Loren_sum(xdiv)*2);
      ysite1.push(Loren1(xdiv));
      ysite2.push(Loren2(xdiv));
      ysite3.push(Loren3(xdiv));
      ysite4.push(Loren4(xdiv));
  };
  
  //Add all values within the array
  var Sx = 0;
  var Sy = 0;
  var Syy = 0;
  var yvar = 0;
  //when the value for y is very low, errors emerge in the code. Subtracting 1 and multiplying by -1 from the raw data helps 
  /*for(var i=0; i< x.length; i++) {
      y0[i]=-(y0[i]-1);
  }*/

  //Calculate background from first and last three values in spectrum. Need to use subtraction to avoid sum issues with javascript
  var y1a=y0[1];
    var y1b=y0[2];
        var y1c=y0[2];

  var y2a=y0[499];
    var y2b=y0[500];
       var y2c=y0[501];

          var bkgd=-(0-y1a-y1b-y1c-y2a-y2b-y2c)/6;


  for(var i=0; i< x.length; i++) {
      //y0[i]=-(y0[i]-1000);
      //Sx += ysum[i]*1;
      //Sy += y0[i]*1;
      yvar += (y[i]-yavg)*(y[i]-yavg);
      Syy += ((y0[i]-(yfitsum[i]+bkgd))*(y0[i]-(yfitsum[i]+bkgd))/(yvar));
  }

  yvar=yvar/(x.length-1);
  var fLen = yfitsum.length;

  //For Displaying HTML ready data table
  var datatable = "<table style='border:1px solid black;width:80%; border-collapse: collapse;'>"

    datatable += "<th style='border:1px solid black;'>Velocity</th>" 
        datatable += "<th style='border:1px solid black;'>Transmission</th>" 
            datatable += "<th style='border:1px solid black;'>Sum</th>" 
                datatable += "<th style='border:1px solid black;'>Site 1</th>" 
                    datatable += "<th style='border:1px solid black;'>Site 2</th>" 
                      datatable += "<th style='border:1px solid black;'>Site 3</th>" 
                        datatable += "<th style='border:1px solid black;'>Site 4</th>" 

  for (i = 0; i < fLen; i++) {
    datatable += "<tr><td style='border:1px solid black;'>" + Math.round(x0[i]*1000)/1000 + "</td><td style='border:1px solid black;'>" + Math.round(y0[i]*1000)/1000 + "</td><td style='border:1px solid black;'>" + Math.round(yfitsum[i]*1000)/1000 + "</td><td style='border:1px solid black;'>" + Math.round(ysite1[i]*1000)/1000 + "</td><td style='border:1px solid black;'>" + Math.round(ysite2[i]*1000)/1000 + "</td><td style='border:1px solid black;'>" + Math.round(ysite3[i]*1000)/1000 + "</td><td style='border:1px solid black;'>" + Math.round(ysite4[i]*1000)/1000 + "</td></tr>";

  }
  datatable += "</table>" 
  document.getElementById("datatabletxt").innerHTML = datatable;


  //For Exporting tab deliminated data table
  var exportdatatable = "Velocity" + ";"
        exportdatatable += "Transmission" + ";"
            exportdatatable += "Sum" + ";"
                exportdatatable += "Site 1" + ";" 
                    exportdatatable += "Site 2" + ";" 
                      exportdatatable += "Site 3" + ";" 
                        exportdatatable += "Site 4" + "\r\n"

  for (i = 0; i < fLen; i++) {
    exportdatatable += Math.round(x0[i]*1000)/1000 + ";" + Math.round(y0[i]*1000)/1000 + ";" + Math.round(yfitsum[i]*1000)/1000 + ";" + Math.round(ysite1[i]*1000)/1000 + ";" + Math.round(ysite2[i]*1000)/1000 + ";" + Math.round(ysite3[i]*1000)/1000 + ";" + Math.round(ysite4[i]*1000)/1000 +"\r\n";
  }
   
  document.getElementById("exportdatatabletxt").innerHTML = exportdatatable;
  

  //Metadata from text file 
  document.getElementById('chisq').value = Math.round(Syy*10)/10;
  document.getElementById('output').innerHTML = "Background: " + Math.round(bkgd*1000)/1000 + "<br>" + " Max. y: " + Math.round(maxy*10)/10 + "<br>" + " Min. y: " + Math.round(miny*10)/10 + "<br>" + "Max. x: " + Math.round(xmax*10)/10 + "<br>" + "Min. x: " + Math.round(xmin*10)/10 + "<br>" + " Sum: " + Math.round(ysum*10)/10 + "<br>" + " Average:" + yavg + "<br>" + " Variance:" + Math.round(yvar);

}
/****************************************************************************/		


/*****Dropdown search box ***************************
function myFunction() {
    document.getElementById("myDropdown").classList.toggle("show");
}

function filterFunction() {
    var input, filter, ul, li, a, i;
    input = document.getElementById("myInput");
    filter = input.value.toUpperCase();
    div = document.getElementById("myDropdown");
    a = div.getElementsByTagName("a");
    for (i = 0; i < a.length; i++) {
        if (a[i].innerHTML.toUpperCase().indexOf(filter) > -1) {
            a[i].style.display = "";
        } else {
            a[i].style.display = "none";
        }
    }
}*/



function loadUrl(location){
  //var canvas = document.getElementById("canvasBHF");
  var load = document.location.href=location;
}



function openCity(evt, cityName) {
    // Declare all variables
    var i, tabcontent, tablinks;

    // Get all elements with class="tabcontent" and hide them
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }

    // Get all elements with class="tablinks" and remove the class "active"
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }

    // Show the current tab, and add an "active" class to the button that opened the tab
    document.getElementById(cityName).style.display = "block";
    evt.currentTarget.className += " active";
}


function openGermanCity(evt, cityName) {
    // Declare all variables
    var i, tabcontent, tablinks;

    // Get all elements with class="tabcontent" and hide them
    tabcontent = document.getElementsByClassName("Germantabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }

    // Get all elements with class="tablinks" and remove the class "active"
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }

    // Show the current tab, and add an "active" class to the button that opened the tab
    document.getElementById(cityName).style.display = "block";
    evt.currentTarget.className += " active";
}


function saveTextAsFile()
{
    var textToSave = document.getElementById("exportdatatabletxt").innerHTML;
    var textToSaveAsBlob = new Blob([textToSave], {type:"text/csv"});
    var textToSaveAsURL = window.URL.createObjectURL(textToSaveAsBlob);
    var fileNameToSaveAs = document.getElementById("inputFileNameToSaveAs").value;
 
    var downloadLink = document.createElement("a");
      downloadLink.download = fileNameToSaveAs;
      downloadLink.innerHTML = "Download File";
      downloadLink.href = textToSaveAsURL;
      downloadLink.onclick = destroyClickedElement;
      downloadLink.style.display = "none";
      document.body.appendChild(downloadLink);
 
    downloadLink.click();
}
 
function destroyClickedElement(event)
{
    document.body.removeChild(event.target);
}



//https://en.wikipedia.org/wiki/Levenberg%E2%80%93Marquardt_algorithm